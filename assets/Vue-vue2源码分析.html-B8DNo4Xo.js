import{_ as n,c as s,o as a,a as t}from"./app-DZsZ2lgd.js";const e={},p=t(`<p>原文链接: <a href="https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html" target="_blank" rel="noopener noreferrer">https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html</a></p><h2 id="文件结构" tabindex="-1"><a class="header-anchor" href="#文件结构"><span>文件结构</span></a></h2><p><strong>源码目录</strong></p><h2 id="调试环境搭建" tabindex="-1"><a class="header-anchor" href="#调试环境搭建"><span>调试环境搭建</span></a></h2><ul><li>安装依赖: npm i</li><li>安装rollup: npm i -g rollup</li><li>修改dev脚本，添加sourcemap，package.json</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">     <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web- full-dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>运行开发命令: <code>npm run dev</code></li><li>引入前面创建的vue.js，<code>samples/commits/index.html</code></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../../dist/vue.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>术语解释:</strong></p><ul><li><code>runtime</code>:仅包含运行时，不包含编译器</li><li><code>common</code>:cjs规范，用于webpack1</li><li><code>esm</code>:ES模块，用于webpack2+</li><li><code>umd: universal module definition</code>，兼容cjs和amd，用于浏览器</li></ul><h2 id="入口" tabindex="-1"><a class="header-anchor" href="#入口"><span>入口</span></a></h2><blockquote><p>dev脚本中 <code>-c scripts/config.js</code> 指明配置文件所在</p></blockquote><p>参数 <code>TARGET:web-full-dev</code> 指明输出文件配置项</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token comment">// Runtime+compiler development build (Browser)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;web-full-dev&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;web/entry-runtime-with-compiler.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// 入口 dest: resolve(&#39;dist/vue.js&#39;),// 目标文件</span></span>
<span class="line">        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;umd&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// 输出规范</span></span>
<span class="line">        <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">he</span><span class="token operator">:</span> <span class="token string">&#39;./entity-decoder&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        banner<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="初始化流程" tabindex="-1"><a class="header-anchor" href="#初始化流程"><span>初始化流程</span></a></h2><ol><li>入口 <strong>platforms/web/entry-runtime-with-compiler.js</strong></li></ol><p>扩展默认$mount方法:处理template或el选项</p><ol start="2"><li><strong>platforms/web/runtime/index.js</strong></li></ol><ul><li>安装web平台特有指令和组件</li><li>定义__patch__:补丁函数，执行patching算法进行更新</li><li>定义$mount:挂载vue实例到指定宿主元素(获得dom并替换宿主元素)</li></ul><ol start="4"><li><strong>core/index.js</strong></li></ol><p>初始化全局api 具体如下:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    Vue<span class="token punctuation">.</span>set <span class="token operator">=</span> <span class="token keyword">set</span></span>
<span class="line">    Vue<span class="token punctuation">.</span>delete <span class="token operator">=</span> del</span>
<span class="line">    Vue<span class="token punctuation">.</span>nextTick <span class="token operator">=</span> nextTick</span>
<span class="line">    </span>
<span class="line">    <span class="token function">initUse</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 实现Vue.use函数</span></span>
<span class="line">    <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 实现Vue.mixin函数</span></span>
<span class="line">    <span class="token function">initExtend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 实现Vue.extend函数</span></span>
<span class="line">    <span class="token function">initAssetRegisters</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 注册实现Vue.component/directive/filter</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li><strong>core/instance/index.js</strong></li></ol><p>Vue构造函数定义</p><p>定义Vue实例API</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 构造函数仅执行了_init this._init(options)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 实现init函数</span></span>
<span class="line">    <span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 状态相关api $data,$props,$set,$delete,$watch </span></span>
<span class="line">    <span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 事件相关api $on,$once,$off,$emit </span></span>
<span class="line">    <span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token comment">// 生命周期api _update,$forceUpdate,$destroy </span></span>
<span class="line">    <span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token comment">// 渲染api _render,$nextTick</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li><strong>core/instance/init.js</strong></li></ol><p>创建组件实例，初始化其数据、属性、事件等</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// $parent,$root,$children,$refs </span></span>
<span class="line">    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 处理父组件传递的事件和回调</span></span>
<span class="line">    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// $slots,$scopedSlots,_c,$createElement </span></span>
<span class="line">    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&#39;beforeCreate&#39;</span><span class="token punctuation">)</span> <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 获取注入数据</span></span>
<span class="line">    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 初始化props，methods，data，computed，watch </span></span>
<span class="line">    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// 提供数据注入</span></span>
<span class="line">    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&#39;created&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li><strong>$mount</strong></li></ol><p><strong>mountComponent</strong></p><blockquote><p>执行挂载，获取vdom并转换为dom</p></blockquote><p><strong>new Watcher()</strong></p><p>创建组件渲染watcher</p><p><strong>updateComponent()</strong></p><p>执行初始化或更新</p><p><strong>update()</strong></p><p>初始化或更新，将传入vdom转换为dom，初始化时执行的是dom创建操作</p><p><strong>render() src\\core\\instance\\render.js</strong></p><p>渲染组件，获取vdom</p><p><strong>整体流程</strong></p><p><code>new Vue()</code> =&gt; <code>_init()</code> =&gt; <code>$mount()</code> =&gt; <code>mountComponent()</code> =&gt; <code>updateComponent()/new Watcher()</code> =&gt; <code>render()</code> =&gt; <code>_update()</code></p><h2 id="数据响应式" tabindex="-1"><a class="header-anchor" href="#数据响应式"><span>数据响应式</span></a></h2><blockquote><p>Vue一大特点是数据响应式，数据的变化会作用于UI而不用进行DOM操作。原理上来讲，是利用了JS语 言特性<code>Object.defineProperty()</code>，通过定义对象属性setter方法拦截对象属性变更，从而将数值的变化 转换为UI的变化</p></blockquote><p>具体实现是在Vue初始化时，会调用initState，它会初始化data，props等，这里着重关注data初始 化，</p><p><strong>整体流程</strong></p><ol><li><strong>initState (vm: Component) src\\core\\instance\\state.js</strong></li></ol><blockquote><p>初始化数据，包括<code>props</code>、<code>methods</code>、<code>data</code>、<code>computed</code>和<code>watch</code></p></blockquote><ol start="2"><li><strong>initData</strong> 核心代码是将<strong>data</strong> 数据响应化</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 执行数据响应化</span></span>
<span class="line">      <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>core/observer/index.js</strong></li></ol><blockquote><p>observe方法返回一个Observer实例</p></blockquote><ol start="4"><li><strong>core/observer/index.js</strong></li></ol><ul><li>Observer对象根据数据类型执行对应的响应化操作</li><li>defineReactive定义对象属性的getter/setter，getter负责添加依赖，setter负责通知更新</li></ul><ol start="5"><li><strong>core/observer/dep.js</strong></li></ol><p>Dep负责管理一组Watcher，包括watcher实例的增删及通知更新</p><ol start="6"><li><strong>Watcher</strong></li></ol><ul><li>Watcher解析一个表达式并收集依赖，当数值变化时触发回调函数，常用于$watch API和指令中。</li><li>每个组件也会有对应的Watcher，数值变化会触发其update函数导致重新渲染</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">addDep</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dep</span><span class="token operator">:</span> Dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>相关API: $watcher</p></blockquote><blockquote><p>测试代码examples\\test\\02-1-reactive.html</p></blockquote><h2 id="数组响应化" tabindex="-1"><a class="header-anchor" href="#数组响应化"><span>数组响应化</span></a></h2><blockquote><p>数组数据变化的侦测跟对象不同，我们操作数组通常使用push、pop、splice等方法，此时没有办法得 知数据变化。所以vue中采取的策略是拦截这些方法并通知dep。</p></blockquote><p><strong>1. src\\core\\observer\\array.js</strong></p><p>为数组原型中的7个可以改变内容的方法定义拦截器</p><p><strong>2. Observer</strong> 中覆盖数组原型</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 替换数组原型</span></span>
<span class="line">      <span class="token function">protoAugment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">)</span> <span class="token comment">// value.__proto__ = arrayMethods </span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>测试代码examples\\test\\02-2-reactive-arr.html</p><p>相关API: <code>Vue.set()/delete()</code></p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span> </span>
<span class="line">    arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> xxx</span>
<span class="line">    </span>
<span class="line">    Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line">    Vue<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="异步更新队列" tabindex="-1"><a class="header-anchor" href="#异步更新队列"><span>异步更新队列</span></a></h2><p>Vue高效的秘诀是一套批量、异步的更新策略</p><h3 id="概念解释" tabindex="-1"><a class="header-anchor" href="#概念解释"><span>概念解释</span></a></h3><ul><li>事件循环Event Loop:浏览器为了协调事件处理、脚本执行、网络请求和渲染等任务而制定的工 作机制。</li><li>宏任务Task:代表一个个离散的、独立的工作单元。浏览器完成一个宏任务，在下一个宏任务执行 开始前，会对⻚面进行重新渲染。主要包括创建文档对象、解析HTML、执行主线JS代码以及各种 事件如⻚面加载、输入、网络事件和定时器等。</li><li>微任务:微任务是更小的任务，是在当前宏任务执行结束后立即执行的任务。如果存在微任务，浏 览器会清空微任务之后再重新渲染。微任务的例子有 Promise 回调函数、DOM变化等。</li></ul><h3 id="vue-中的具体实现" tabindex="-1"><a class="header-anchor" href="#vue-中的具体实现"><span><strong>vue</strong> 中的具体实现</span></a></h3><ul><li><p>异步:只要侦听到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据变 更。</p></li><li><p>批量:如果同一个 watcher 被多次触发，只会被推入到队列中一次。去重对于避免不必要的计算 和 DOM 操作是非常重要的。然后，在下一个的事件循环“tick”中，Vue 刷新队列执行实际工作</p></li><li><p>异步策略:Vue 在内部对异步队列尝试使用原生的 Promise.then 、 MutationObserver</p></li></ul><p>或 setImmediate ，如果执行环境都不支持，则会采用 setTimeout 代替。</p><p><strong>1. update() core\\observer\\watcher.js</strong></p><blockquote><p>dep.notify()之后watcher执行更新，执行入队操作</p></blockquote><p><strong>2. queueWatcher(watcher) core\\observer\\scheduler.js</strong></p><blockquote><p>执行watcher入队操作</p></blockquote><p><strong>3. nextTick(flushSchedulerQueue) core\\util\\next-tick.js</strong></p><blockquote><p>nextTick按照特定异步策略执行队列操作</p></blockquote><p>watcher中update执行三次，但run仅执行一次，且数值变化对dom的影响也不是立竿⻅影的。</p><p>请大家研究一下相关API: <code>vm.$nextTick(cb)</code></p><h2 id="虚拟dom" tabindex="-1"><a class="header-anchor" href="#虚拟dom"><span>虚拟DOM</span></a></h2><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h3><blockquote><p>虚拟DOM(Virtual DOM)是对DOM的JS抽象表示，它们是<strong>JS</strong> 对象，能够描述DOM结构和关系。应用 的各种状态变化会作用于虚拟DOM，最终映射到DOM上。</p></blockquote><h3 id="体验虚拟dom" tabindex="-1"><a class="header-anchor" href="#体验虚拟dom"><span>体验虚拟<strong>DOM</strong></span></a></h3><blockquote><p>vue中虚拟dom基于snabbdom实现，安装snabbdom并体验</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token operator">&lt;</span> <span class="token operator">!</span><span class="token constant">DOCTYPE</span> html <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>html lang <span class="token operator">=</span> <span class="token string">&quot;en&quot;</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>head <span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">div &gt; &lt;!--安装并引入snabbdom--&gt;&lt;script src = &quot;..</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>snabbdom<span class="token operator">/</span>dist<span class="token operator">/</span>snabbdom<span class="token punctuation">.</span>js&quot; <span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token operator">/</span> <span class="token operator">/</span> 之前编写的响应式函数</span>
<span class="line">          <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> val</span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token function">set</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                val <span class="token operator">=</span> newVal <span class="token comment">// 通知更新 update()</span></span>
<span class="line">              <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token comment">// 导入patch的工厂init，h是产生vnode的工厂 const { init, h } = snabbdom</span></span>
<span class="line">          <span class="token comment">// 获取patch函数</span></span>
<span class="line">          <span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token comment">// 上次vnode，由patch()返回 let vnode;</span></span>
<span class="line">          <span class="token comment">// 更新函数，将数据操作转换为dom操作，返回新vnode function update() {</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 初始化，没有上次vnode，传入宿主元素和vnode vnode = patch(app, render())</span></span>
<span class="line">          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 更新，传入新旧vnode对比并做更新 vnode = patch(vnode, render())</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token comment">// 渲染函数，返回vnode描述dom结构 function render() {</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          <span class="token comment">// 赋一个日期作为初始值</span></span>
<span class="line">          obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token comment">// 定时改变数据，更新函数会重新执行 setInterval(() =&gt; {</span></span>
<span class="line">          obj<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">    <span class="token operator">&lt;</span> <span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>body <span class="token operator">&gt;</span> </span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="优点" tabindex="-1"><a class="header-anchor" href="#优点"><span>优点</span></a></h3><ul><li>虚拟DOM轻量、快速:当它们发生变化时通过新旧虚拟DOM比对可以得到最小DOM操作量，配 合异步更新策略减少刷新频率，从而提升性能</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token function">patch</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>跨平台:将虚拟dom更新转换为不同运行时特殊操作实现跨平台</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../../node_modules/snabbdom/dist/snabbdom-style.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token comment">// 增加style模块</span></span>
<span class="line">    <span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">[</span>snabbdom_style<span class="token punctuation">.</span>default<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 添加节点样式描述</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#39;red&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>兼容性:还可以加入兼容性代码增强操作的兼容性</li></ul><h3 id="必要性" tabindex="-1"><a class="header-anchor" href="#必要性"><span>必要性</span></a></h3><blockquote><p>vue 1.0中有细粒度的数据变化侦测，它是不需要虚拟DOM的，但是细粒度造成了大量开销，这对于大 型项目来说是不可接受的。因此，vue 2.0选择了中等粒度的解决方案，每一个组件一个watcher实例， 这样状态变化时只能通知到组件，再通过引入虚拟DOM去进行比对和渲染。</p></blockquote><h3 id="整体流程" tabindex="-1"><a class="header-anchor" href="#整体流程"><span>整体流程</span></a></h3><p><strong>1. mountComponent() core/instance/lifecycle.js</strong></p><p>渲染、更新组件</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token comment">// 定义更新函数</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 实际调用是在lifeCycleMixin中定义的_update和renderMixin中定义的_render</span></span>
<span class="line">    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. _render core/instance/render.js</strong></p><p>生成虚拟dom</p><p><strong>3. _update core\\instance\\lifecycle.js</strong></p><p>update负责更新dom，转换vnode为dom</p><p><strong>4.<strong>patch</strong>() platforms/web/runtime/index.js</strong></p><p>__patch__是在平台特有代码中指定的</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__patch__ <span class="token operator">=</span> inBrowser <span class="token operator">?</span> patch <span class="token operator">:</span> noop</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>测试代码，examples\\test\\04-vdom.html</p></blockquote><h2 id="patch获取" tabindex="-1"><a class="header-anchor" href="#patch获取"><span>patch获取</span></a></h2><blockquote><p>patch是createPatchFunction的返回值，传递nodeOps和modules是web平台特别实现</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">patch</span><span class="token operator">:</span> Function <span class="token operator">=</span> <span class="token function">createPatchFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nodeOps<span class="token punctuation">,</span> modules <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>1. platforms\\web\\runtime\\node-ops.js</strong></p><p>定义各种原生dom基础操作方法</p><p><strong>2. platforms\\web\\runtime\\modules\\index.js</strong></p><p>modules 定义了属性更新实现</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">componentUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="patch-实现" tabindex="-1"><a class="header-anchor" href="#patch-实现"><span><strong>patch</strong> 实现</span></a></h3><p><strong>1. patch core\\vdom\\patch.js</strong></p><blockquote><p>首先进行树级别比较，可能有三种情况:增删改</p></blockquote><ul><li><code>new VNode</code>不存在就删;</li><li><code>old VNode</code> 不存在就增;</li><li>都存在就执行<code>diff</code>执行更新</li></ul><ol start="2"><li><strong>patchVnode</strong></li></ol><blockquote><p>比较两个VNode，包括三种类型操作:属性更新、文本更新、子节点更新</p></blockquote><p>具体规则如下:</p><ul><li>新老节点均有<strong>children</strong> 子节点，则对子节点进行diff操作，调用<strong>updateChildren</strong></li><li>如果新节点有子节点而老节点没有子节点，先清空老节点的文本内容，然后为其新增子节点。</li><li>当新节点没有子节点而老节点有子节点的时候，则移除该节点的所有子节点。</li><li>当新老节点都无子节点的时候，只是文本的替换。</li></ul><p>测试，04-vdom.html</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token comment">// patchVnode过程分解</span></span>
<span class="line">    <span class="token comment">// 1.div#demo // 2.h1</span></span>
<span class="line">    <span class="token comment">// 3.text</span></span>
<span class="line">    <span class="token comment">// 4.p</span></span>
<span class="line">    <span class="token comment">// 5.text</span></span>
<span class="line">    updateChildren updateChildren 文本相同跳过 updateChildren setTextContent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. updateChildren</strong></p><blockquote><p>updateChildren主要作用是用一种较高效的方式比对新旧两个VNode的children得出最小操作补丁。执 行一个双循环是传统方式，vue中针对web场景特点做了特别的算法优化，我们看图说话:</p></blockquote><blockquote><p>在新老两组VNode节点的左右头尾两侧都有一个变量标记，在遍历过程中这几个变量都会向中间靠拢。 当<strong>oldStartIdx &gt; oldEndIdx</strong>或者<strong>newStartIdx &gt; newEndIdx</strong>时结束循环</p></blockquote><p>下面是遍历规则:</p><ul><li>首先，oldStartVnode、oldEndVnode与newStartVnode、newEndVnode两两交叉比较，共有4种比较 方法。</li><li>当 oldStartVnode和newStartVnode 或者 oldEndVnode和newEndVnode 满足sameVnode，直接将该 VNode节点进行patchVnode即可，不需再遍历就完成了一次循环。如下图</li></ul><blockquote><p>如果oldStartVnode与newEndVnode满足sameVnode。说明oldStartVnode已经跑到了oldEndVnode 后面去了，进行patchVnode的同时还需要将真实DOM节点移动到oldEndVnode的后面。</p></blockquote><blockquote><p>如果oldEndVnode与newStartVnode满足sameVnode，说明oldEndVnode跑到了oldStartVnode的前 面，进行patchVnode的同时要将oldEndVnode对应DOM移动到oldStartVnode对应DOM的前面</p></blockquote><blockquote><p>如果以上情况均不符合，则在old VNode中找与newStartVnode相同的节点，若存在执行 patchVnode，同时将elmToMove移动到oldStartIdx对应的DOM的前面。</p></blockquote><blockquote><p>当然也有可能newStartVnode在old VNode节点中找不到一致的sameVnode，这个时候会调用 createElm创建一个新的DOM节点。</p></blockquote><p>至此循环结束，但是我们还需要处理剩下的节点。</p><blockquote><p>当结束时oldStartIdx &gt; oldEndIdx，这个时候旧的VNode节点已经遍历完了，但是新的节点还没有。说 明了新的VNode节点实际上比老的VNode节点多，需要将剩下的VNode对应的DOM插入到真实DOM 中，此时调用addVnodes(批量调用createElm接口)</p></blockquote><blockquote><p>但是，当结束时<code>newStartIdx &gt; newEndIdx</code>时，说明新的VNode节点已经遍历完了，但是老的节点还有 剩余，需要从文档中删 的节点删除。</p></blockquote><h2 id="模板编译" tabindex="-1"><a class="header-anchor" href="#模板编译"><span>模板编译</span></a></h2><p>模板编译的主要目标是将模板**(template)<strong>转换为渲染函数</strong>(render)**</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token parameter">template</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="模板编译必要性" tabindex="-1"><a class="header-anchor" href="#模板编译必要性"><span>模板编译必要性</span></a></h3><blockquote><p>Vue 2.0需要用到VNode描述视图以及各种交互，手写显然不切实际，因此用户只需编写类似HTML代码 的Vue模板，通过编译器将模板转换为可返回VNode的render函数。</p></blockquote><h3 id="体验模板编译" tabindex="-1"><a class="header-anchor" href="#体验模板编译"><span>体验模板编译</span></a></h3><blockquote><p>带编译器的版本中，可以使用template或el的方式声明模板，06-1-compiler.html</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">attrs</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;Vue模板编 译&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果大致如下:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">attrs</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;Vue模板编译&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>元素节点使用createElement创建，别名_c _</li><li>_本文节点使用createTextVNode创建，别名_v</li><li>表达式先使用toString格式化，别名_s</li><li>其他渲染helpers:src\\core\\instance\\render-helpers\\index.js</li></ul><h3 id="整体流程-1" tabindex="-1"><a class="header-anchor" href="#整体流程-1"><span>整体流程</span></a></h3><p><strong>1. compileToFunctions</strong></p><blockquote><p>若指定template或el选项，则会执行编译，<strong>platforms\\web\\entry-runtime-with-compiler.js</strong></p></blockquote><p><strong>2. 编译过程</strong></p><blockquote><p>编译分为三步:解析、优化和生成，<strong>src\\compiler\\index.js</strong></p></blockquote><p>测试代码06-1-compiler.html</p><h3 id="模板编译过程" tabindex="-1"><a class="header-anchor" href="#模板编译过程"><span>模板编译过程</span></a></h3><p>实现模板编译共有三个阶段:解析、优化和生成</p><ol><li>解析 <strong>- parse</strong></li></ol><p>解析器将模板解析为抽象语法树，基于AST可以做优化或者代码生成工作。 调试查看得到的AST，<code>**/src/compiler/parser/index.js**</code>，结构如下:</p><p>​</p><blockquote><p>解析器内部分了<strong>HTML</strong> 解析器、文本解析器和过滤器解析器，最主要是HTML解析器</p></blockquote><ol start="2"><li>优化 <strong>- optimize</strong></li></ol><blockquote><p>优化器的作用是在AST中找出静态子树并打上标记。静态子树是在AST中永远不变的节点，如纯文本节 点。</p></blockquote><p><strong>标记静态子树的好处:</strong></p><ul><li>每次重新渲染，不需要为静态子树创建新节点</li><li>虚拟DOM中patch时，可以跳过静态子树</li></ul><blockquote><p>测试代码，06-2-compiler-optimize.html 代码实现，<strong>src/compiler/optimizer.js - optimize</strong></p></blockquote><ol start="3"><li>代码生成 <strong>- generate</strong></li></ol><ul><li>将AST转换成渲染函数中的内容，即代码字符串</li><li>generate方法生成渲染函数代码，<strong>src/compiler/codegen/index.js</strong></li></ul><p>生成的code⻓这样</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">_c(&#39;div&#39;,{attrs:{&quot;id&quot;:&quot;demo&quot;}},[ _c(&#39;h1&#39;,[_v(&quot;Vue.js测试&quot;)]), _c(&#39;p&#39;,[_v(_s(foo))])</span>
<span class="line">    ])</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="典型指令的实现-v-if、v-for" tabindex="-1"><a class="header-anchor" href="#典型指令的实现-v-if、v-for"><span>典型指令的实现:v-if、v-for</span></a></h2><ol><li>解析v-if:<strong>parser/index.js</strong></li></ol><blockquote><p>processIf用于处理v-if解析</p></blockquote><ol start="2"><li>代码生成，<strong>codegen/index.js</strong></li></ol><blockquote><p>genIfConditions等用于生成条件语句相关代码</p></blockquote><p>生成结果:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token string">&quot;with(this){return _c(&#39;div&#39;,{attrs:{&quot;</span>id<span class="token string">&quot;:&quot;</span>demo&quot;<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;no title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;abc&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>解析v-for:<strong>parser/index.js</strong></li></ol><blockquote><p>processFor用于处理v-for指令</p></blockquote><blockquote><p>解析结果:<code>v-for=&quot;item in items&quot; for:&#39;items&#39; alias:&#39;item&#39;</code></p></blockquote><ol start="4"><li>代码生成，<strong>src\\compiler\\codegen\\index.js</strong></li></ol><p>genFor用于生成相应代码</p><p>生成结果</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token string">&quot;with(this){return _c(&#39;div&#39;,{attrs:{&quot;</span>id<span class="token string">&quot;:&quot;</span>demo<span class="token string">&quot;}},[_m(0),_v(&quot;</span> <span class="token string">&quot;),(foo)?_c(&#39;p&#39;, [_v(_s(foo))]):_e(),_v(&quot;</span> &quot;<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">_l</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span>s<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span>&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>v-if，v-for这些指令只能在编译器阶段处理，如果我们要在render函数处理条件或循环只能使用if 和for</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 渲染内容跟foo的值挂钩，只能用if语句</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token operator">==</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">with</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">attrs</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_m</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">_e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="组件化机制" tabindex="-1"><a class="header-anchor" href="#组件化机制"><span>组件化机制</span></a></h2><h3 id="组件声明-vue-component" tabindex="-1"><a class="header-anchor" href="#组件声明-vue-component"><span>组件声明:<strong>Vue.component()</strong></span></a></h3><blockquote><p><code>initAssetRegisters(Vue) src/core/global-api/assets.js</code></p></blockquote><blockquote><p>组件注册使用extend方法将配置转换为构造函数并添加到<code>components</code>选项</p></blockquote><h3 id="组件实例创建及挂载" tabindex="-1"><a class="header-anchor" href="#组件实例创建及挂载"><span>组件实例创建及挂载</span></a></h3><p>观察生成的渲染函数</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token string">&quot;with(this){return _c(&#39;div&#39;,{attrs:{&quot;</span>id<span class="token string">&quot;:&quot;</span>demo<span class="token string">&quot;}},[ _c(&#39;h1&#39;,[_v(&quot;</span>虚拟<span class="token constant">DOM</span><span class="token string">&quot;)]),_v(&quot;</span> <span class="token string">&quot;), _c(&#39;p&#39;,[_v(_s(foo))]),_v(&quot;</span> &quot;<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;comp&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 对于组件的处理并无特殊之处</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span>&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="整体流程-2" tabindex="-1"><a class="header-anchor" href="#整体流程-2"><span>整体流程</span></a></h3><blockquote><p>首先创建的是根实例，首次_render()时，会得到整棵树的VNode结构，其中自定义组件相关的主要有: <strong>createComponent() - src/core/vdom/create-component.js</strong></p></blockquote><p><strong>1. 组件vnode创建</strong></p><p><strong>createComponent() - src/core/vdom/patch.js</strong></p><blockquote><p>创建组件实例并挂载，vnode转换为dom</p></blockquote><p><strong>2. 整体流程:</strong></p><blockquote><p><code>new Vue() =&gt; $mount() =&gt; vm._render() =&gt; createElement() =&gt; createComponent() =&gt; vm._update() =&gt; patch() =&gt; createElm =&gt; createComponent()</code></p></blockquote><h3 id="创建组件vnode" tabindex="-1"><a class="header-anchor" href="#创建组件vnode"><span>创建组件<strong>VNode</strong></span></a></h3><p><strong>1. _createElement - src\\core\\vdom\\create-element.js</strong></p><blockquote><p><code>_createElement</code>实际执行VNode创建的函数，由于传入tag是非保留标签，因此判定为自定义组件通过 <code>createComponent</code>去创建</p></blockquote><p><strong>2. createComponent - src/core/vdom/create-component.js</strong></p><blockquote><p>创建组件VNode，保存了上一步处理得到的组件构造函数，props，事件等</p></blockquote><h3 id="创建组件实例" tabindex="-1"><a class="header-anchor" href="#创建组件实例"><span>创建组件实例</span></a></h3><blockquote><p>根组件执行更新函数时，会递归创建子元素和子组件，入口<code>createElm</code></p></blockquote><p><strong>1. createEle() core/vdom/patch.js line751</strong></p><blockquote><p>首次执行<code>_update()</code>时，<code>patch()</code>会通过createEle()创建根元素，子元素创建研究从这里开始</p></blockquote><p><strong>2. createComponent core/vdom/patch.js line144</strong></p><p>自定义组件创建</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line">    <span class="token comment">// 组件实例创建、挂载</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token boolean">false</span></span>
<span class="line">      <span class="token comment">/* hydrating */</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 元素引用指定vnode.elm，元素属性创建等 initComponent(vnode, insertedVnodeQueue) // 插入到父元素</span></span>
<span class="line">      <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>isReactivated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">reactivateComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><blockquote><p>Vue源码学习使我们能够深入理解原理，解答很多开发中的疑惑，规避很多潜在的错误，写出更好的代 码。学习大神的代码，能够学习编程思想，设计模式，训练基本功，提升内力。</p></blockquote><p>阅读全文</p>`,219),o=[p];function c(l,i){return a(),s("div",null,o)}const r=n(e,[["render",c],["__file","Vue-vue2源码分析.html.vue"]]),d=JSON.parse('{"path":"/Vue-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html","title":"","lang":"zh-CN","frontmatter":{"description":"原文链接: https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html 文件结构 源码目录 调试环境搭建 安装依赖: npm i 安装rollup: npm i -g rollup 修改dev脚本，添加sourcem...","head":[["meta",{"property":"og:url","content":"https://interview.leeguoo.com/Vue-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html"}],["meta",{"property":"og:site_name","content":"前端面试题集锦"}],["meta",{"property":"og:description","content":"原文链接: https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html 文件结构 源码目录 调试环境搭建 安装依赖: npm i 安装rollup: npm i -g rollup 修改dev脚本，添加sourcem..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-04T18:48:03.000Z"}],["meta",{"property":"article:modified_time","content":"2024-06-04T18:48:03.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-04T18:48:03.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"文件结构","slug":"文件结构","link":"#文件结构","children":[]},{"level":2,"title":"调试环境搭建","slug":"调试环境搭建","link":"#调试环境搭建","children":[]},{"level":2,"title":"入口","slug":"入口","link":"#入口","children":[]},{"level":2,"title":"初始化流程","slug":"初始化流程","link":"#初始化流程","children":[]},{"level":2,"title":"数据响应式","slug":"数据响应式","link":"#数据响应式","children":[]},{"level":2,"title":"数组响应化","slug":"数组响应化","link":"#数组响应化","children":[]},{"level":2,"title":"异步更新队列","slug":"异步更新队列","link":"#异步更新队列","children":[{"level":3,"title":"概念解释","slug":"概念解释","link":"#概念解释","children":[]},{"level":3,"title":"vue 中的具体实现","slug":"vue-中的具体实现","link":"#vue-中的具体实现","children":[]}]},{"level":2,"title":"虚拟DOM","slug":"虚拟dom","link":"#虚拟dom","children":[{"level":3,"title":"概念","slug":"概念","link":"#概念","children":[]},{"level":3,"title":"体验虚拟DOM","slug":"体验虚拟dom","link":"#体验虚拟dom","children":[]},{"level":3,"title":"优点","slug":"优点","link":"#优点","children":[]},{"level":3,"title":"必要性","slug":"必要性","link":"#必要性","children":[]},{"level":3,"title":"整体流程","slug":"整体流程","link":"#整体流程","children":[]}]},{"level":2,"title":"patch获取","slug":"patch获取","link":"#patch获取","children":[{"level":3,"title":"patch 实现","slug":"patch-实现","link":"#patch-实现","children":[]}]},{"level":2,"title":"模板编译","slug":"模板编译","link":"#模板编译","children":[{"level":3,"title":"模板编译必要性","slug":"模板编译必要性","link":"#模板编译必要性","children":[]},{"level":3,"title":"体验模板编译","slug":"体验模板编译","link":"#体验模板编译","children":[]},{"level":3,"title":"整体流程","slug":"整体流程-1","link":"#整体流程-1","children":[]},{"level":3,"title":"模板编译过程","slug":"模板编译过程","link":"#模板编译过程","children":[]}]},{"level":2,"title":"典型指令的实现:v-if、v-for","slug":"典型指令的实现-v-if、v-for","link":"#典型指令的实现-v-if、v-for","children":[]},{"level":2,"title":"组件化机制","slug":"组件化机制","link":"#组件化机制","children":[{"level":3,"title":"组件声明:Vue.component()","slug":"组件声明-vue-component","link":"#组件声明-vue-component","children":[]},{"level":3,"title":"组件实例创建及挂载","slug":"组件实例创建及挂载","link":"#组件实例创建及挂载","children":[]},{"level":3,"title":"整体流程","slug":"整体流程-2","link":"#整体流程-2","children":[]},{"level":3,"title":"创建组件VNode","slug":"创建组件vnode","link":"#创建组件vnode","children":[]},{"level":3,"title":"创建组件实例","slug":"创建组件实例","link":"#创建组件实例","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"updatedTime":1717526883000,"contributors":[{"name":"guoli","email":"guoli@zhihu.com","commits":1}]},"autoDesc":true,"filePathRelative":"Vue-vue2源码分析.md","excerpt":"<p>原文链接: <a href=\\"https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://interview.poetries.top/principle-docs/vue/19-vue2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html</a></p>\\n<h2>文件结构</h2>\\n<p><strong>源码目录</strong></p>"}');export{r as comp,d as data};
