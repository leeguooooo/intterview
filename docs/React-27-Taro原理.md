åŸæ–‡é“¾æ¥: [https://interview.poetries.top/principle-docs/react/27-Taro%E5%8E%9F%E7%90%86.html](https://interview.poetries.top/principle-docs/react/27-Taro%E5%8E%9F%E7%90%86.html)

## ä¸€ã€Taro çš„å®‰è£…ä¸ä½¿ç”¨

### 1.1 å®‰è£…
```javascript
    $ npm install -g @tarojs/cli
```  
```javascript
    taro -V
```

### 1.2 ä½¿ç”¨

ä½¿ç”¨å‘½ä»¤åˆ›å»ºæ¨¡æ¿é¡¹ç›®
```javascript
    $ taro init myApp
```

![](/images/s_poetries_work_gitee_2020_09_92.png)

#### 1.2.1 å¾®ä¿¡å°ç¨‹åº

> é€‰æ‹©å¾®ä¿¡å°ç¨‹åºæ¨¡å¼ï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œç„¶åé€‰æ‹©é¡¹ç›®æ ¹ç›®å½•è¿›è¡Œé¢„è§ˆ

å¾®ä¿¡å°ç¨‹åºç¼–è¯‘é¢„è§ˆåŠæ‰“åŒ…
```bash
    # npm script
    $ npm run dev:weapp
    $ npm run build:weapp
```

#### 1.2.2 ç™¾åº¦å°ç¨‹åº

> é€‰æ‹©ç™¾åº¦å°ç¨‹åºæ¨¡å¼ï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶æ‰“å¼€[ç™¾åº¦å¼€å‘è€…å·¥å…· (opens new
> window)](https://smartprogram.baidu.com/docs/develop/devtools/show_sur/)ï¼Œç„¶ååœ¨é¡¹ç›®ç¼–è¯‘å®Œåé€‰æ‹©é¡¹ç›®æ ¹ç›®å½•ä¸‹
> dist ç›®å½•è¿›è¡Œé¢„è§ˆ

ç™¾åº¦å°ç¨‹åºç¼–è¯‘é¢„è§ˆåŠæ‰“åŒ…
```bash
    # npm script
    $ npm run dev:swan
    $ npm run build:swan
```

#### 1.2.3 æ”¯ä»˜å®å°ç¨‹åº

> é€‰æ‹©æ”¯ä»˜å®å°ç¨‹åºæ¨¡å¼ï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½å¹¶æ‰“å¼€[æ”¯ä»˜å®å°ç¨‹åºå¼€å‘è€…å·¥å…· (opens new
> window)](https://docs.alipay.com/mini/developer/getting-
> started/)ï¼Œç„¶ååœ¨é¡¹ç›®ç¼–è¯‘å®Œåé€‰æ‹©é¡¹ç›®æ ¹ç›®å½•ä¸‹ dist ç›®å½•è¿›è¡Œé¢„è§ˆ

æ”¯ä»˜å®å°ç¨‹åºç¼–è¯‘é¢„è§ˆåŠæ‰“åŒ…ï¼š
```bash
    # npm script
    $ npm run dev:alipay
    $ npm run build:alipay
```

#### 1.2.4 H5

H5 ç¼–è¯‘é¢„è§ˆåŠæ‰“åŒ…ï¼š
```bash
    # npm script
    $ npm run dev:h5
    
    # ä»…é™å…¨å±€å®‰è£…
    $ taro build --type h5 --watch
```

#### 1.2.5 React Native

> `React Native` ç«¯è¿è¡Œéœ€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ`React Native` ç«¯ç›¸å…³çš„è¿è¡Œè¯´æ˜è¯·å‚è§ `React Native` [æ•™ç¨‹
> (opens new window)](https://nervjs.github.io/taro/docs/react-native.html)
```bash
    # npm script
    $ npm run dev:rn
```

### 1.3 æ›´æ–° Taro

> `Taro` æä¾›äº†æ›´æ–°å‘½ä»¤æ¥æ›´æ–° `CLI`å·¥å…·è‡ªèº«å’Œé¡¹ç›®ä¸­ `Taro` ç›¸å…³çš„ä¾èµ–ã€‚

æ›´æ–° `taro-cli` å·¥å…·
```bash
    # taro
    $ taro update self
    # npm 
```

> æ›´æ–°é¡¹ç›®ä¸­ `Taro` ç›¸å…³çš„ä¾èµ–ï¼Œè¿™ä¸ªéœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸‹æ‰§è¡Œ
```bash
    $ taro update project
```

## äºŒã€Taro å¼€å‘è¯´æ˜ä¸æ³¨æ„äº‹é¡¹

### 2.1 å¾®ä¿¡å°ç¨‹åºå¼€å‘å·¥å…·çš„é…ç½®

> ç”±äº `Taro` ç¼–è¯‘åçš„ä»£ç å·²ç»ç»è¿‡äº†è½¬ä¹‰å’Œå‹ç¼©ï¼Œå› æ­¤è¿˜éœ€è¦æ³¨æ„å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„é¡¹ç›®è®¾ç½®

  * è®¾ç½®å…³é—­ `ES6` è½¬ `ES5` åŠŸèƒ½
  * è®¾ç½®å…³é—­ä¸Šä¼ ä»£ç æ—¶æ ·å¼è‡ªåŠ¨è¡¥å…¨
  * è®¾ç½®å…³é—­ä»£ç å‹ç¼©ä¸Šä¼ 

![](/images/s_poetries_work_gitee_2020_09_239.png)

### 2.2 Taro ä¸ React çš„å·®å¼‚

> ç”±äºå¾®ä¿¡å°ç¨‹åºçš„é™åˆ¶ï¼Œ`React` ä¸­æŸäº›å†™æ³•å’Œç‰¹æ€§åœ¨ `Taro` ä¸­è¿˜æœªèƒ½å®ç°ï¼Œåç»­å°†ä¼šé€æ¸å®Œå–„ã€‚ æˆªæ­¢åˆ°æœ¬å°å†Œå‘å¸ƒå‰ï¼Œ`Taro` çš„æœ€æ–°ç‰ˆæœ¬ä¸º
> `1.1`ï¼Œå› æ­¤ä»¥ä¸‹è®²è§£é»˜è®¤ç‰ˆæœ¬ä¸º `1.1`

#### 2.2.1 æš‚ä¸æ”¯æŒåœ¨ render() ä¹‹å¤–çš„æ–¹æ³•å®šä¹‰ JSX

> ç”±äºå¾®ä¿¡å°ç¨‹åºçš„ `template` ä¸èƒ½åŠ¨æ€ä¼ å€¼å’Œä¼ å…¥å‡½æ•°ï¼Œ`Taro` æš‚æ—¶ä¹Ÿæ²¡åŠæ³•æ”¯æŒåœ¨ç±»æ–¹æ³•ä¸­å®šä¹‰ `JSX`

æ— æ•ˆæƒ…å†µ
```jsx
    class App extends Component {
      _render() {
        return <View />
      }
    }
    
    class App extends Component {
      renderHeader(showHeader) {
        return showHeader && <Header />
      }
    }
    
    class App extends Component {
      renderHeader = (showHeader) => {
        return showHeader& & <Header />
      }
    }...
```

**è§£å†³æ–¹æ¡ˆ**

åœ¨ `render` æ–¹æ³•ä¸­å®šä¹‰
```jsx
    class App extends Component {
    
      render () {
        const { showHeader, showMain } = this.state
        const header = showHeader && <Header />
        const main = showMain && <Main />
        return (
          <View>
            {header}
            {main}
          </View>
        )
      }
    }...
```

#### 2.2.2 ä¸èƒ½åœ¨åŒ…å« JSX å…ƒç´ çš„ map å¾ªç¯ä¸­ä½¿ç”¨ if è¡¨è¾¾å¼

æ— æ•ˆæƒ…å†µ
```jsx
    numbers.map((number) => {
      let element = null
      const isOdd = number % 2
      if (isOdd) {
        element = <Custom />
      }
      return element
    })
    
    numbers.map((number) => {
      let isOdd = false
      if (number % 2) {
        isOdd = true
      }
      return isOdd && <Custom />
    })...
```

**è§£å†³æ–¹æ¡ˆ**

å°½é‡åœ¨ `map` å¾ªç¯ä¸­ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼æˆ–é€»è¾‘è¡¨è¾¾å¼ã€‚
```jsx
    numbers.map((number) => {
      const isOdd = number % 2
      return isOdd ? <Custom /> : null
    })
    
    numbers.map((number) => {
      const isOdd = number % 2
      return isOdd && <Custom />
    })...
```

#### 2.2.3 ä¸èƒ½ä½¿ç”¨ Array.map ä¹‹å¤–çš„æ–¹æ³•æ“ä½œ JSX æ•°ç»„

> Taro åœ¨å°ç¨‹åºç«¯å®é™…ä¸ŠæŠŠ JSX è½¬æ¢æˆäº†å­—ç¬¦ä¸²æ¨¡æ¿ï¼Œè€Œä¸€ä¸ªåŸç”Ÿ `JSX` è¡¨è¾¾å¼å®é™…ä¸Šæ˜¯ä¸€ä¸ª `React/Nerv` å…ƒç´ (react -
> element)çš„æ„é€ å™¨ï¼Œå› æ­¤åœ¨åŸç”Ÿ JSX ä¸­ä½ å¯ä»¥å¯¹ä»»ä½•ä¸€ç»„ React å…ƒç´ è¿›è¡Œæ“ä½œã€‚ä½†åœ¨ Taro ä¸­ä½ åªèƒ½ä½¿ç”¨ map æ–¹æ³•ï¼ŒTaro
> è½¬æ¢æˆå°ç¨‹åºä¸­ `wx:for`...

æ— æ•ˆæƒ…å†µ
```jsx
    test.push(<View />)
    
    numbers.forEach(numbers => {
      if (someCase) {
        a = <View />
      }
    })
    
    test.shift(<View />)
    
    components.find(component => {
      return component === <View />
    })
    
    components.some(component => component.constructor.__proto__ === <View />.constructor)
    
    numbers.filter(Boolean).map((number) => {
      const element = <View />
      return <View />
    })...
```

**è§£å†³æ–¹æ¡ˆ**

å…ˆå¤„ç†å¥½éœ€è¦éå†çš„æ•°ç»„ï¼Œç„¶åå†ç”¨å¤„ç†å¥½çš„æ•°ç»„è°ƒç”¨ map æ–¹æ³•ã€‚
```jsx
    numbers.filter(isOdd).map((number) => <View />)
    
    for (let index = 0; index < array.length; index++) {
      // do you thing with array
    }
    
    const element = array.map(item => {
      return <View />
    })...
```

#### 2.2.4 ä¸èƒ½åœ¨ JSX å‚æ•°ä¸­ä½¿ç”¨åŒ¿åå‡½æ•°

æ— æ•ˆæƒ…å†µ
```jsx
    <View onClick={() => this.handleClick()} />
    
    <View onClick={(e) => this.handleClick(e)} />
    
    <View onClick={() => ({})} />
    
    <View onClick={function () {}} />
    
    <View onClick={function (e) {this.handleClick(e)}} />...
```

**è§£å†³æ–¹æ¡ˆ**

ä½¿ç”¨ `bind` æˆ– ç±»å‚æ•°ç»‘å®šå‡½æ•°ã€‚
```javascript
    <View onClick={this.props.hanldeClick.bind(this)} />
```

#### 2.2.5 ä¸èƒ½åœ¨ JSX å‚æ•°ä¸­ä½¿ç”¨å¯¹è±¡å±•å¼€ç¬¦

> å¾®ä¿¡å°ç¨‹åºç»„ä»¶è¦æ±‚æ¯ä¸€ä¸ªä¼ å…¥ç»„ä»¶çš„å‚æ•°éƒ½å¿…é¡»é¢„å…ˆè®¾å®šå¥½ï¼Œè€Œå¯¹è±¡å±•å¼€ç¬¦åˆ™æ˜¯åŠ¨æ€ä¼ å…¥ä¸å›ºå®šæ•°é‡çš„å‚æ•°ã€‚æ‰€ä»¥ `Taro` æ²¡æœ‰åŠæ³•æ”¯æŒè¯¥åŠŸèƒ½

æ— æ•ˆæƒ…å†µ
```jsx
    <View {...this.props} />
    
    <View {...props} />
    
    <Custom {...props} />
```

**è§£å†³æ–¹æ¡ˆ**

å¼€å‘è€…è‡ªè¡Œèµ‹å€¼ï¼š
```js
    render () {
        const { id, title } = obj
        return <View id={id} title={title} />
    }...
```

#### 2.2.6 ä¸å…è®¸åœ¨ JSX å‚æ•°ï¼ˆpropsï¼‰ä¸­ä¼ å…¥ JSX å…ƒç´ 

> ç”±äºå¾®ä¿¡å°ç¨‹åºå†…ç½®çš„ç»„ä»¶åŒ–çš„ç³»ç»Ÿä¸èƒ½é€šè¿‡å±æ€§ï¼ˆpropsï¼‰ ä¼ å‡½æ•°ï¼Œè€Œ props ä¼ é€’å‡½æ•°å¯ä»¥è¯´æ˜¯ React
> ä½“ç³»çš„æ ¹åŸºä¹‹ä¸€ï¼Œæˆ‘ä»¬åªèƒ½è‡ªå·±å®ç°ä¸€å¥—ç»„ä»¶åŒ–ç³»ç»Ÿã€‚è€Œè‡ªåˆ¶çš„ç»„ä»¶åŒ–ç³»ç»Ÿä¸èƒ½ä½¿ç”¨å†…ç½®ç»„ä»¶åŒ–çš„ slot åŠŸèƒ½ã€‚ä¸¤æƒç›¸å®³å–å…¶è½»ï¼Œæˆ‘ä»¬æš‚æ—¶åªèƒ½ä¸æ”¯æŒè¯¥åŠŸèƒ½...

æ— æ•ˆæƒ…å†µ
```jsx
    <Custom child={<View />} />
    
    <Custom child={() => <View />} />
    
    <Custom child={function () { <View /> }} />
    
    <Custom child={ary.map(a => <View />)} />...
```

**è§£å†³æ–¹æ¡ˆ**

> é€šè¿‡ `props` ä¼ å€¼åœ¨ `JSX` æ¨¡æ¿ä¸­é¢„å…ˆåˆ¤å®šæ˜¾ç¤ºå†…å®¹ï¼Œæˆ–é€šè¿‡ `props.children` æ¥åµŒå¥—å­ç»„ä»¶

#### 2.2.7 ä¸æ”¯æŒæ— çŠ¶æ€ç»„ä»¶ï¼ˆStateless Component)

> ç”±äºå¾®ä¿¡çš„ `template` èƒ½åŠ›æœ‰é™ï¼Œä¸æ”¯æŒåŠ¨æ€ä¼ å€¼å’Œå‡½æ•°ï¼Œ`Taro` æš‚æ—¶åªæ”¯æŒä¸€ä¸ªæ–‡ä»¶è‡ªå®šä¹‰ä¸€ä¸ªç»„ä»¶ã€‚ä¸ºäº†é¿å…å¼€å‘è€…ç–‘æƒ‘ï¼Œæš‚æ—¶ä¸æ”¯æŒå®šä¹‰
> `Stateless Component`

æ— æ•ˆæƒ…å†µ
```jsx
    function Test () {
      return <View />
    }
    
    function Test (ary) {
      return ary.map(() => <View />)
    }
    
    const Test = () => {
      return <View />
    }
    
    const Test = function () {
      return <View />
    }...
```

**è§£å†³æ–¹æ¡ˆ**

ä½¿ç”¨ `class` å®šä¹‰ç»„ä»¶ã€‚
```js
    class App extends Component {
      render () {
        return (
          <View />
        )
      }
    }
```

### 2.3 å‘½åè§„èŒƒ

> Taro å‡½æ•°å‘½åä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œå¦‚`onClick`ï¼Œç”±äºå¾®ä¿¡å°ç¨‹åºçš„ WXML ä¸æ”¯æŒä¼ é€’å‡½æ•°ï¼Œå‡½æ•°åç¼–è¯‘åä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼ç»‘å®šåœ¨ WXML
> ä¸Šï¼Œå›¿äº WXML çš„é™åˆ¶ï¼Œå‡½æ•°åæœ‰ä¸‰é¡¹é™åˆ¶

  * æ–¹æ³•åä¸èƒ½å«æœ‰æ•°å­—
  * æ–¹æ³•åä¸èƒ½ä»¥ä¸‹åˆ’çº¿å¼€å¤´æˆ–ç»“å°¾
  * æ–¹æ³•åçš„é•¿åº¦ä¸èƒ½å¤§äº `20`

è¯·éµå®ˆä»¥ä¸Šè§„åˆ™ï¼Œå¦åˆ™ç¼–è¯‘åçš„ä»£ç åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯

![](/images/s_poetries_work_gitee_2020_09_240.png)

### 2.4 æ¨èå®‰è£… ESLint ç¼–è¾‘å™¨æ’ä»¶

> Taro æœ‰äº›å†™æ³•è·Ÿ React æœ‰äº›å·®å¼‚ï¼Œå¯ä»¥é€šè¿‡å®‰è£… ESLint
> ç›¸å…³çš„ç¼–è¾‘å™¨æ’ä»¶æ¥è·å¾—äººæ€§åŒ–çš„æç¤ºã€‚ç”±äºä¸åŒç¼–è¾‘å™¨å®‰è£…çš„æ’ä»¶æœ‰æ‰€ä¸åŒï¼Œå…·ä½“å®‰è£…æ–¹æ³•è¯·è‡ªè¡Œæœç´¢ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ å¦‚ä¸‹å›¾ï¼Œå°±æ˜¯å®‰è£…æ’ä»¶åè·å¾—çš„æç¤º

![](/images/s_poetries_work_gitee_2020_09_241.png)
![](/images/s_poetries_work_gitee_2020_09_242.png)

### 2.5 æœ€ä½³ç¼–ç æ–¹å¼

**ç»„ä»¶ä¼ é€’å‡½æ•°å±æ€§åä»¥ on å¼€å¤´**

> åœ¨ `Taro` ä¸­ï¼Œçˆ¶ç»„ä»¶è¦å¾€å­ç»„ä»¶ä¼ é€’å‡½æ•°ï¼Œå±æ€§åå¿…é¡»ä»¥`on` å¼€å¤´
```js
    // è°ƒç”¨ Custom ç»„ä»¶ï¼Œä¼ å…¥ handleEvent å‡½æ•°ï¼Œå±æ€§åä¸º `onTrigger`
    class Parent extends Component {
    
      handleEvent () {
    
      }
    
      render () {
        return (
          <Custom onTrigger={this.handleEvent}></Custom>
        )
      }
    }...
```

> è¿™æ˜¯å› ä¸ºï¼Œå¾®ä¿¡å°ç¨‹åºç«¯ç»„ä»¶åŒ–æ˜¯ä¸èƒ½ç›´æ¥ä¼ é€’å‡½æ•°ç±»å‹ç»™å­ç»„ä»¶çš„ï¼Œåœ¨ Taro ä¸­æ˜¯å€ŸåŠ©ç»„ä»¶çš„äº‹ä»¶æœºåˆ¶æ¥å®ç°è¿™ä¸€ç‰¹æ€§ï¼Œè€Œå°ç¨‹åºä¸­ä¼ å…¥äº‹ä»¶çš„æ—¶å€™å±æ€§åå†™æ³•ä¸º
> `bindmyevent` æˆ–è€… `bind:myevent`
```jsx
    <!-- å½“è‡ªå®šä¹‰ç»„ä»¶è§¦å‘â€œmyeventâ€äº‹ä»¶æ—¶ï¼Œè°ƒç”¨â€œonMyEventâ€æ–¹æ³• -->
    <component-tag-name bindmyevent="onMyEvent" />
    <!-- æˆ–è€…å¯ä»¥å†™æˆ -->
    <component-tag-name bind:myevent="onMyEvent" />
```

> æ‰€ä»¥ `Taro`ä¸­çº¦å®šç»„ä»¶ä¼ é€’å‡½æ•°å±æ€§åä»¥ `on` å¼€å¤´ï¼ŒåŒæ—¶è¿™ä¹Ÿå’Œå†…ç½®ç»„ä»¶çš„äº‹ä»¶ç»‘å®šå†™æ³•ä¿æŒä¸€è‡´äº†...

**å°ç¨‹åºç«¯ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å°ä¼ å…¥çš„å‡½æ•°**

> å‰é¢å·²ç»æåˆ°å°ç¨‹åºç«¯çš„ç»„ä»¶ä¼ å…¥å‡½æ•°çš„åŸç†ï¼Œæ‰€ä»¥åœ¨å°ç¨‹åºç«¯ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å°ä¼ å…¥çš„å‡½æ•°ï¼Œå› ä¸ºæ‹¿ä¸åˆ°ç»“æœï¼Œä½†æ˜¯ `this.props.onXxx &&
> this.props.onXxx()` è¿™ç§åˆ¤æ–­å‡½æ•°æ˜¯å¦ä¼ å…¥æ¥è¿›è¡Œè°ƒç”¨çš„å†™æ³•æ˜¯å®Œå…¨æ”¯æŒçš„...

**å°ç¨‹åºç«¯ä¸è¦å°†åœ¨æ¨¡æ¿ä¸­ç”¨åˆ°çš„æ•°æ®è®¾ç½®ä¸º undefined**

  * ç”±äºå°ç¨‹åºä¸æ”¯æŒå°† `data` ä¸­ä»»ä½•ä¸€é¡¹çš„ `value` è®¾ä¸º `undefined` ï¼Œåœ¨ `setState` çš„æ—¶å€™ä¹Ÿè¯·é¿å…è¿™ä¹ˆç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨ `null` æ¥æ›¿ä»£ã€‚
  * å°ç¨‹åºç«¯ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å° `this.props.children` åœ¨å¾®ä¿¡å°ç¨‹åºç«¯æ˜¯é€šè¿‡`<slot />` æ¥å®ç°å¾€è‡ªå®šä¹‰ç»„ä»¶ä¸­ä¼ å…¥å…ƒç´ çš„ï¼Œè€Œ `Taro` åˆ©ç”¨ `this.props.children` åœ¨ç¼–è¯‘æ—¶å®ç°äº†è¿™ä¸€åŠŸèƒ½ï¼Œ `this.props.children` ä¼šç›´æ¥è¢«ç¼–è¯‘æˆ `<slot />` æ ‡ç­¾ï¼Œæ‰€ä»¥å®ƒåœ¨å°ç¨‹åºç«¯å±äºè¯­æ³•ç³–çš„å­˜åœ¨ï¼Œè¯·ä¸è¦åœ¨ç»„ä»¶ä¸­æ‰“å°å®ƒ...

**ç»„ä»¶ state ä¸ props é‡Œå­—æ®µé‡åçš„é—®é¢˜**

> ä¸è¦åœ¨ `state`ä¸ `props` ä¸Šç”¨åŒåçš„å­—æ®µï¼Œå› ä¸ºè¿™äº›è¢«å­—æ®µåœ¨å¾®ä¿¡å°ç¨‹åºä¸­éƒ½ä¼šæŒ‚åœ¨ `data` ä¸Š

**å°ç¨‹åºä¸­é¡µé¢ç”Ÿå‘½å‘¨æœŸ componentWillMount ä¸ä¸€è‡´é—®é¢˜**

> ç”±äºå¾®ä¿¡å°ç¨‹åºé‡Œé¡µé¢åœ¨ `onLoad` æ—¶æ‰èƒ½æ‹¿åˆ°é¡µé¢çš„è·¯ç”±å‚æ•°ï¼Œè€Œé¡µé¢ `onLoad` å‰ç»„ä»¶éƒ½å·²ç» `attached` äº†ã€‚å› æ­¤é¡µé¢çš„
> `componentWillMount` å¯èƒ½ä¼šä¸é¢„æœŸä¸å¤ªä¸€è‡´ã€‚ä¾‹å¦‚ï¼š
```js
    // é”™è¯¯å†™æ³•
    render () {
      // åœ¨ willMount ä¹‹å‰æ— æ³•æ‹¿åˆ°è·¯ç”±å‚æ•°
      const abc = this.$router.params.abc
      return <Custom adc={abc} />
    }
    
    // æ­£ç¡®å†™æ³•
    componentWillMount () {
      const abc = this.$router.params.abc
      this.setState({
        abc
      })
    }
    render () {
      // å¢åŠ ä¸€ä¸ªå…¼å®¹åˆ¤æ–­
      return this.state.abc && <Custom adc={abc} />
    }
```

å¯¹äºä¸éœ€è¦ç­‰åˆ°é¡µé¢ `willMount` ä¹‹åå–è·¯ç”±å‚æ•°çš„é¡µé¢åˆ™æ²¡æœ‰ä»»ä½•å½±å“...

**JS ç¼–ç å¿…é¡»ç”¨å•å¼•å·**

> åœ¨ `Taro` ä¸­ï¼Œ`JS` ä»£ç é‡Œå¿…é¡»ä¹¦å†™å•å¼•å·ï¼Œç‰¹åˆ«æ˜¯ `JSX` ä¸­ï¼Œå¦‚æœå‡ºç°åŒå¼•å·ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯

**process.env çš„ä½¿ç”¨**

> ä¸è¦ä»¥è§£æ„çš„æ–¹å¼æ¥è·å–é€šè¿‡ `env`é…ç½®çš„ `process.env` ç¯å¢ƒå˜é‡ï¼Œè¯·ç›´æ¥ä»¥å®Œæ•´ä¹¦å†™çš„æ–¹å¼
> `process.env.NODE_ENV`æ¥è¿›è¡Œä½¿ç”¨
```js
    // é”™è¯¯å†™æ³•ï¼Œä¸æ”¯æŒ
    const { NODE_ENV = 'development' } = process.env
    if (NODE_ENV === 'development') {
      ...
    }
    
    // æ­£ç¡®å†™æ³•
    if (process.env.NODE_ENV === 'development') {
    
    }...
```

**é¢„åŠ è½½**

> åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œä»è°ƒç”¨ `Taro.navigateTo`ã€`Taro.redirectTo` æˆ– `Taro.switchTab`
> åï¼Œåˆ°é¡µé¢è§¦å‘`componentWillMount` ä¼šæœ‰ä¸€å®šå»¶æ—¶ã€‚å› æ­¤ä¸€äº›ç½‘ç»œè¯·æ±‚å¯ä»¥æå‰åˆ°å‘èµ·è·³è½¬å‰ä¸€åˆ»å»è¯·æ±‚

Taro æä¾›äº† `componentWillPreload` é’©å­ï¼Œå®ƒæ¥æ”¶é¡µé¢è·³è½¬çš„å‚æ•°ä½œä¸ºå‚æ•°ã€‚å¯ä»¥æŠŠéœ€è¦é¢„åŠ è½½çš„å†…å®¹é€šè¿‡ `return`
è¿”å›ï¼Œç„¶ååœ¨é¡µé¢è§¦å‘ `componentWillMount` åå³å¯é€šè¿‡ `this.$preloadData` è·å–åˆ°é¢„åŠ è½½çš„å†…å®¹ã€‚...
```js
    class Index extends Component {
      componentWillMount () {
        console.log('isFetching: ', this.isFetching)
        this.$preloadData
          .then(res => {
            console.log('res: ', res)
            this.isFetching = false
          })
      }
    
      componentWillPreload (params) {
        return this.fetchData(params.url)
      }
    
      fetchData () {
        this.isFetching = true
        ...
      }
    }...
```

## ä¸‰ã€Taro è®¾è®¡æ€æƒ³åŠæ¶æ„

> åœ¨ Taro ä¸­é‡‡ç”¨çš„æ˜¯ç¼–è¯‘åŸç†çš„æ€æƒ³ï¼Œæ‰€è°“ç¼–è¯‘åŸç†ï¼Œå°±æ˜¯ä¸€ä¸ªå¯¹è¾“å…¥çš„æºä»£ç è¿›è¡Œè¯­æ³•åˆ†æï¼Œè¯­æ³•æ ‘æ„å»ºï¼Œéšåå¯¹è¯­æ³•æ ‘è¿›è¡Œè½¬æ¢æ“ä½œå†è§£æç”Ÿæˆç›®æ ‡ä»£ç çš„è¿‡ç¨‹ã€‚

![](/images/s_poetries_work_gitee_2020_09_243.png)

### 3.1 æŠ¹å¹³å¤šç«¯å·®å¼‚

> åŸºäºç¼–è¯‘åŸç†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å°† Taro
> æºç ç¼–è¯‘æˆä¸åŒç«¯ä¸Šå¯ä»¥è¿è¡Œçš„ä»£ç äº†ï¼Œä½†æ˜¯è¿™å¯¹äºå®ç°å¤šç«¯å¼€å‘è¿˜æ˜¯è¿œè¿œä¸å¤Ÿã€‚å› ä¸ºä¸åŒçš„å¹³å°éƒ½æœ‰è‡ªå·±çš„ç‰¹æ€§ï¼Œæ¯ä¸€ä¸ªå¹³å°éƒ½ä¸å°½ç›¸åŒï¼Œè¿™äº›å·®å¼‚ä¸»è¦ä½“ç°åœ¨ä¸åŒçš„ç»„ä»¶æ ‡å‡†ä¸ä¸åŒçš„
> API æ ‡å‡†ä»¥åŠä¸åŒçš„è¿è¡Œæœºåˆ¶ä¸Š

ä»¥å°ç¨‹åºå’Œ Web ç«¯ä¸ºä¾‹

![](/images/s_poetries_work_gitee_2020_09_244.png)
![](/images/s_poetries_work_gitee_2020_09_245.png)

  * å¯ä»¥çœ‹å‡ºå°ç¨‹åºå’Œ Web ç«¯ä¸Šç»„ä»¶æ ‡å‡†ä¸ API æ ‡å‡†æœ‰å¾ˆå¤§å·®å¼‚ï¼Œè¿™äº›å·®å¼‚ä»…ä»…é€šè¿‡ä»£ç ç¼–è¯‘æ‰‹æ®µæ˜¯æ— æ³•æŠ¹å¹³çš„ï¼Œä¾‹å¦‚ä½ ä¸èƒ½ç›´æ¥åœ¨ç¼–è¯‘æ—¶å°†å°ç¨‹åºçš„ `<view />` ç›´æ¥ç¼–è¯‘æˆ `<div />`ï¼Œå› ä¸ºä»–ä»¬è™½ç„¶çœ‹ä¸Šå»æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯ä»–ä»¬çš„ç»„ä»¶å±æ€§æœ‰å¾ˆå¤§ä¸åŒçš„ï¼Œä»…ä»…ä¾é ä»£ç ç¼–è¯‘ï¼Œæ— æ³•åšåˆ°ä¸€è‡´ï¼ŒåŒç†ï¼Œä¼—å¤š `API` ä¹Ÿé¢ä¸´ä¸€æ ·çš„æƒ…å†µã€‚é’ˆå¯¹è¿™æ ·çš„æƒ…å†µï¼Œ`Taro` é‡‡ç”¨äº†å®šåˆ¶ä¸€å¥—è¿è¡Œæ—¶æ ‡å‡†æ¥æŠ¹å¹³ä¸åŒå¹³å°ä¹‹é—´çš„å·®å¼‚ã€‚
  * è¿™ä¸€å¥—æ ‡å‡†ä¸»è¦ä»¥ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬æ ‡å‡†è¿è¡Œæ—¶æ¡†æ¶ã€æ ‡å‡†åŸºç¡€ç»„ä»¶åº“ã€æ ‡å‡†ç«¯èƒ½åŠ› APIï¼Œå…¶ä¸­è¿è¡Œæ—¶æ¡†æ¶å’Œ API å¯¹åº” `@taro/taro`ï¼Œç»„ä»¶åº“å¯¹åº” `@tarojs/components`ï¼Œé€šè¿‡åœ¨ä¸åŒç«¯å®ç°è¿™äº›æ ‡å‡†ï¼Œä»è€Œè¾¾åˆ°å»å·®å¼‚åŒ–çš„ç›®çš„...

![](/images/s_poetries_work_gitee_2020_09_245.png)
![](/images/s_poetries_work_gitee_2020_09_246.png)

## å››ã€CLI åŸç†åŠä¸åŒç«¯çš„è¿è¡Œæœºåˆ¶

### 4.1 taro-cli åŒ…

#### 4.1.1 Taro å‘½ä»¤

> `taro-cli` åŒ…ä½äº `Taro` å·¥ç¨‹çš„ `Packages` ç›®å½•ä¸‹ï¼Œé€šè¿‡ `npm install -g @tarojs/cli`
> å…¨å±€å®‰è£…åï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ª `Taro` å‘½ä»¤ã€‚ä¸»è¦è´Ÿè´£é¡¹ç›®åˆå§‹åŒ–ã€ç¼–è¯‘ã€æ„å»ºç­‰ã€‚ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ `Taro` ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æç¤º...
```js
    âœ taro
    ğŸ‘½ Taro v0.0.63
    
    
      Usage: taro <command> [options]
    
      Options:
    
        -V, --version       output the version number
        -h, --help          output usage information
    
      Commands:
    
        init [projectName]  Init a project with default templete
        build               Build a project with options
        update              Update packages of taro
        help [cmd]          display help for [cmd]...
```

é‡Œé¢åŒ…å«äº† Taro æ‰€æœ‰å‘½ä»¤ç”¨æ³•åŠä½œç”¨ã€‚

#### 4.1.2 åŒ…ç®¡ç†ä¸å‘å¸ƒ

  * é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ `taro-cli` åŒ…ä¸ `Taro` å·¥ç¨‹çš„å…³ç³»ã€‚
  * å°† `Taro` å·¥ç¨‹ `Clone` ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°å·¥ç¨‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œæ•´ä½“ç»“æ„è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼š
```javascript
    .
    â”œâ”€â”€ CHANGELOG.md
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ README.md
    â”œâ”€â”€ build
    â”œâ”€â”€ docs
    â”œâ”€â”€ lerna-debug.log
    â”œâ”€â”€ lerna.json        // Lerna é…ç½®æ–‡ä»¶
    â”œâ”€â”€ package.json
    â”œâ”€â”€ packages
    â”‚Â Â  â”œâ”€â”€ eslint-config-taro
    â”‚Â Â  â”œâ”€â”€ eslint-plugin-taro
    â”‚Â Â  â”œâ”€â”€ postcss-plugin-constparse
    â”‚Â Â  â”œâ”€â”€ postcss-pxtransform
    â”‚Â Â  â”œâ”€â”€ taro
    â”‚Â Â  â”œâ”€â”€ taro-async-await
    â”‚Â Â  â”œâ”€â”€ taro-cli
    â”‚Â Â  â”œâ”€â”€ taro-components
    â”‚Â Â  â”œâ”€â”€ taro-components-rn
    â”‚Â Â  â”œâ”€â”€ taro-h5
    â”‚Â Â  â”œâ”€â”€ taro-plugin-babel
    â”‚Â Â  â”œâ”€â”€ taro-plugin-csso
    â”‚Â Â  â”œâ”€â”€ taro-plugin-sass
    â”‚Â Â  â”œâ”€â”€ taro-plugin-uglifyjs
    â”‚Â Â  â”œâ”€â”€ taro-redux
    â”‚Â Â  â”œâ”€â”€ taro-redux-h5
    â”‚Â Â  â”œâ”€â”€ taro-rn
    â”‚Â Â  â”œâ”€â”€ taro-rn-runner
    â”‚Â Â  â”œâ”€â”€ taro-router
    â”‚Â Â  â”œâ”€â”€ taro-transformer-wx
    â”‚Â Â  â”œâ”€â”€ taro-weapp
    â”‚Â Â  â””â”€â”€ taro-webpack-runner
    â””â”€â”€ yarn.lock...
```

> `Taro` é¡¹ç›®ä¸»è¦æ˜¯ç”±ä¸€ç³»åˆ— `NPM` åŒ…ç»„æˆï¼Œä½äºå·¥ç¨‹çš„ `Packages` ç›®å½•ä¸‹ã€‚å®ƒçš„åŒ…ç®¡ç†æ–¹å¼å’Œ `Babel`
> é¡¹ç›®ä¸€æ ·ï¼Œå°†æ•´ä¸ªé¡¹ç›®ä½œä¸ºä¸€ä¸ª `monorepo` æ¥è¿›è¡Œç®¡ç†ï¼Œå¹¶ä¸”åŒæ ·ä½¿ç”¨äº†åŒ…ç®¡ç†å·¥å…· `Lerna`

`Packages` ç›®å½•ä¸‹åå‡ ä¸ªåŒ…ä¸­ï¼Œæœ€å¸¸ç”¨çš„é¡¹ç›®åˆå§‹åŒ–ä¸æ„å»ºçš„å‘½ä»¤è¡Œå·¥å…· `Taro CLI` å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚åœ¨ `Taro` å·¥ç¨‹æ ¹ç›®å½•è¿è¡Œ
`lerna publish` å‘½ä»¤ä¹‹åï¼Œ`lerna.json` é‡Œé¢é…ç½®å¥½çš„æ‰€æœ‰çš„åŒ…ä¼šè¢«å‘å¸ƒåˆ° `NPM` ä¸Š

#### 4.1.3 taro-cli åŒ…çš„ç›®å½•ç»“æ„å¦‚ä¸‹
```js
    ./
    â”œâ”€â”€ bin        // å‘½ä»¤è¡Œ
    â”‚   â”œâ”€â”€ taro              // taro å‘½ä»¤
    â”‚   â”œâ”€â”€ taro-build        // taro build å‘½ä»¤
    â”‚   â”œâ”€â”€ taro-update       // taro update å‘½ä»¤
    â”‚   â””â”€â”€ taro-init         // taro init å‘½ä»¤
    â”œâ”€â”€ package.json
    â”œâ”€â”€ node_modules
    â”œâ”€â”€ src
    â”‚   â”œâ”€â”€ build.js        // taro build å‘½ä»¤è°ƒç”¨ï¼Œæ ¹æ® type ç±»å‹è°ƒç”¨ä¸åŒçš„è„šæœ¬
    â”‚   â”œâ”€â”€ config
    â”‚   â”‚   â”œâ”€â”€ babel.js        // Babel é…ç½®
    â”‚   â”‚   â”œâ”€â”€ babylon.js      // JavaScript è§£æå™¨ babylon é…ç½®
    â”‚   â”‚   â”œâ”€â”€ browser_list.js // autoprefixer browsers é…ç½®
    â”‚   â”‚   â”œâ”€â”€ index.js        // ç›®å½•ååŠå…¥å£æ–‡ä»¶åç›¸å…³é…ç½®
    â”‚   â”‚   â””â”€â”€ uglify.js
    â”‚   â”œâ”€â”€ creator.js
    â”‚   â”œâ”€â”€ h5.js       // æ„å»ºh5 å¹³å°ä»£ç 
    â”‚   â”œâ”€â”€ project.js  // taro init å‘½ä»¤è°ƒç”¨ï¼Œåˆå§‹åŒ–é¡¹ç›®
    â”‚   â”œâ”€â”€ rn.js       // æ„å»ºReact Native å¹³å°ä»£ç 
    â”‚   â”œâ”€â”€ util        // ä¸€ç³»åˆ—å·¥å…·å‡½æ•°
    â”‚   â”‚   â”œâ”€â”€ index.js
    â”‚   â”‚   â”œâ”€â”€ npm.js
    â”‚   â”‚   â””â”€â”€ resolve_npm_files.js
    â”‚   â””â”€â”€ weapp.js        // æ„å»ºå°ç¨‹åºä»£ç è½¬æ¢
    â”œâ”€â”€ templates           // è„šæ‰‹æ¶æ¨¡ç‰ˆ
    â”‚   â””â”€â”€ default
    â”‚       â”œâ”€â”€ appjs
    â”‚       â”œâ”€â”€ config
    â”‚       â”‚   â”œâ”€â”€ dev
    â”‚       â”‚   â”œâ”€â”€ index
    â”‚       â”‚   â””â”€â”€ prod
    â”‚       â”œâ”€â”€ editorconfig
    â”‚       â”œâ”€â”€ eslintrc
    â”‚       â”œâ”€â”€ gitignor...
```

> é€šè¿‡ä¸Šé¢çš„ç›®å½•æ ‘å¯ä»¥å‘ç°ï¼Œ`taro-cli` å·¥ç¨‹çš„æ–‡ä»¶å¹¶ä¸ç®—å¤šï¼Œä¸»è¦ç›®å½•æœ‰ï¼š`/bin`ã€`/src`ã€`/template`

### 4.2 ç”¨åˆ°çš„æ ¸å¿ƒåº“

  * [tj/commander.js (opens new window)](https://github.com/tj/commander.js/) Node.js - å‘½ä»¤è¡Œæ¥å£å…¨é¢çš„è§£å†³æ–¹æ¡ˆ
  * [jprichardson/node-fs-extra (opens new window)](https://github.com/jprichardson/node-fs-extra) \- åœ¨ Node.js çš„ fs åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›æ–°çš„æ–¹æ³•ï¼Œæ›´å¥½ç”¨ï¼Œè¿˜å¯ä»¥æ‹·è´æ¨¡æ¿ã€‚
  * [chalk/chalk (opens new window)](https://github.com/chalk/chalk) \- å¯ä»¥ç”¨äºæ§åˆ¶ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²çš„æ ·å¼
  * [SBoudrias/Inquirer.js - Node.js (opens new window)](https://github.com/SBoudrias/Inquirer.js/) å‘½ä»¤è¡Œäº¤äº’å·¥å…·ï¼Œé€šç”¨çš„å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢é›†åˆï¼Œå¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº¤äº’
  * [sindresorhus/ora (opens new window)](https://github.com/sindresorhus/ora) \- å®ç°åŠ è½½ä¸­çš„çŠ¶æ€æ˜¯ä¸€ä¸ª Loading åŠ å‰é¢è½¬èµ·æ¥çš„å°åœˆåœˆï¼ŒæˆåŠŸäº†æ˜¯ä¸€ä¸ª Success åŠ å‰é¢ä¸€ä¸ªå°é’©é’©
  * [SBoudrias/mem-fs-editor (opens new window)](https://github.com/sboudrias/mem-fs-editor) \- æä¾›ä¸€ç³»åˆ— APIï¼Œæ–¹ä¾¿æ“ä½œæ¨¡æ¿æ–‡ä»¶
  * [shelljs/shelljs  (opens new window)](https://github.com/shelljs/shelljs) \- ShellJS æ˜¯ Node.js æ‰©å±•ï¼Œç”¨äºå®ç° Unix shell å‘½ä»¤æ‰§è¡Œã€‚

### 4.3 Taro Init

![](/images/s_poetries_work_gitee_2020_09_247.png)

> å½“æˆ‘ä»¬å…¨å±€å®‰è£… `taro-cli` åŒ…ä¹‹åï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œé‡Œå°±æœ‰äº† Taro å‘½ä»¤

  * é‚£ä¹ˆ `Taro` å‘½ä»¤æ˜¯æ€æ ·æ·»åŠ è¿›å»çš„å‘¢ï¼Ÿå…¶åŸå› åœ¨äº `package.json` é‡Œé¢çš„ `bin`å­—æ®µï¼š
```js
    "bin": {
        "taro": "bin/taro"
    }
```

ä¸Šé¢ä»£ç æŒ‡å®šï¼ŒTaro å‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸º `bin/taro` ã€‚NPM ä¼šå¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œåœ¨ `[prefix]/bin`
ç›®å½•ä¸‹å»ºç«‹ç¬¦å·é“¾æ¥ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒTaro ä¼šå»ºç«‹ç¬¦å·é“¾æ¥ `[prefix]/bin/taro`ã€‚ç”±äº
`[prefix]/bin`ç›®å½•ä¼šåœ¨è¿è¡Œæ—¶åŠ å…¥ç³»ç»Ÿçš„ PATH å˜é‡ï¼Œå› æ­¤åœ¨è¿è¡Œ NPM æ—¶ï¼Œå°±å¯ä»¥ä¸å¸¦è·¯å¾„ï¼Œç›´æ¥é€šè¿‡å‘½ä»¤æ¥è°ƒç”¨è¿™äº›è„šæœ¬ã€‚

  * å…³äº`prefix`ï¼Œå¯ä»¥é€šè¿‡`npm config get prefix`è·å–ã€‚
```javascript
    $ npm config get prefix
    /usr/local
```

é€šè¿‡ä¸‹åˆ—å‘½ä»¤å¯ä»¥æ›´åŠ æ¸…æ™°çš„çœ‹åˆ°å®ƒä»¬ä¹‹é—´çš„ç¬¦å·é“¾æ¥...
```javascript
    $ ls -al `which taro`
    lrwxr-xr-x  1 chengshuai  admin  40  6 15 10:51 /usr/local/bin/taro -> ../lib/node_modules/@tarojs/cli/bin/taro...
```

#### 4.3.1 å‘½ä»¤å…³è”ä¸å‚æ•°è§£æ

> è¿™é‡Œå°±ä¸å¾—ä¸æåˆ°ä¸€ä¸ªæœ‰ç”¨çš„åŒ…ï¼š`tj/commander.js` ï¼Œ`Node.js` å‘½ä»¤è¡Œæ¥å£å…¨é¢çš„è§£å†³æ–¹æ¡ˆï¼Œçµæ„Ÿæ¥è‡ªäº Ruby's
> commanderã€‚å¯ä»¥è‡ªåŠ¨çš„è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œåˆå¹¶å¤šé€‰é¡¹ï¼Œå¤„ç†çŸ­å‚ç­‰ç­‰ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä¸Šæ‰‹ç®€å•

æ›´ä¸»è¦çš„ï¼Œ`commander` æ”¯æŒ `Git` é£æ ¼çš„å­å‘½ä»¤å¤„ç†ï¼Œå¯ä»¥æ ¹æ®å­å‘½ä»¤è‡ªåŠ¨å¼•å¯¼åˆ°ä»¥ç‰¹å®šæ ¼å¼å‘½åçš„å‘½ä»¤æ‰§è¡Œæ–‡ä»¶ï¼Œæ–‡ä»¶åçš„æ ¼å¼æ˜¯
`[command]-[subcommand]`ï¼Œä¾‹å¦‚

  * `taro init` => `taro-init`
  * `taro build` => `taro-build`
  * `/bin/taro` æ–‡ä»¶å†…å®¹ä¸å¤šï¼Œæ ¸å¿ƒä»£ç ä¹Ÿå°±é‚£å‡ è¡Œ `.command()` å‘½ä»¤ï¼š
```js
    #! /usr/bin/env node
    
    const program = require('commander')
    const {getPkgVersion} = require('../src/util')
    
    program
      .version(getPkgVersion())
      .usage('<command> [options]')
      .command('init [projectName]', 'Init a project with default templete')
      .command('build', 'Build a project with options')
      .command('update', 'Update packages of taro')
      .parse(process.argv)...
```

> é€šè¿‡ä¸Šé¢ä»£ç å¯ä»¥å‘ç°ï¼Œ`init`ï¼Œ`build` ï¼Œ`update`ç­‰å‘½ä»¤éƒ½æ˜¯é€šè¿‡`.command(name,
> description)`æ–¹æ³•å®šä¹‰çš„ï¼Œç„¶åé€šè¿‡ `.parse(arg)` æ–¹æ³•è§£æå‚æ•°

#### 4.3.2 å‚æ•°è§£æåŠä¸ç”¨æˆ·äº¤äº’

  * `commander` åŒ…å¯ä»¥è‡ªåŠ¨è§£æå‘½ä»¤å’Œå‚æ•°ï¼Œåœ¨é…ç½®å¥½å‘½ä»¤ä¹‹åï¼Œè¿˜èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆ `help`ï¼ˆå¸®åŠ©ï¼‰å‘½ä»¤å’Œ`version`ï¼ˆç‰ˆæœ¬æŸ¥çœ‹ï¼‰ å‘½ä»¤ã€‚å¹¶ä¸”é€šè¿‡`program.args`ä¾¿å¯ä»¥è·å–å‘½ä»¤è¡Œçš„å‚æ•°ï¼Œç„¶åå†æ ¹æ®å‚æ•°æ¥è°ƒç”¨ä¸åŒçš„è„šæœ¬ã€‚
  * ä½†å½“æˆ‘ä»¬è¿è¡Œ `taro init` å‘½ä»¤åï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤è¡Œäº¤äº’åˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ...
```javascript
    $ taro init taroDemo
    Taro å³å°†åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®!
    Need help? Go and open issue: https://github.com/NervJS/taro/issues/new
    
    Taro v0.0.50
    
    ? è¯·è¾“å…¥é¡¹ç›®ä»‹ç»ï¼
    ? è¯·é€‰æ‹©æ¨¡æ¿ é»˜è®¤æ¨¡æ¿...
```

è¿™é‡Œä½¿ç”¨çš„æ˜¯ `SBoudrias/Inquirer.js` æ¥å¤„ç†å‘½ä»¤è¡Œäº¤äº’ã€‚

ç”¨æ³•å…¶å®å¾ˆç®€å•
```js
    const inquirer = require('inquirer')  // npm i inquirer -D
    
    if (typeof conf.description !== 'string') {
          prompts.push({
            type: 'input',
            name: 'description',
            message: 'è¯·è¾“å…¥é¡¹ç›®ä»‹ç»ï¼'
          })
    }...
```

  * `prompt()`æ¥å—ä¸€ä¸ªé—®é¢˜å¯¹è±¡çš„æ•°æ®ï¼Œåœ¨ç”¨æˆ·ä¸ç»ˆç«¯äº¤äº’è¿‡ç¨‹ä¸­ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥å­˜æ”¾åœ¨ä¸€ä¸ªç­”æ¡ˆå¯¹è±¡ä¸­ï¼Œç„¶åè¿”å›ä¸€ä¸ª`Promise`ï¼Œé€šè¿‡`then()`è·å–åˆ°è¿™ä¸ªç­”æ¡ˆå¯¹è±¡ã€‚ å€Ÿæ­¤ï¼Œæ–°é¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬å·ã€æè¿°ç­‰ä¿¡æ¯å¯ä»¥ç›´æ¥é€šè¿‡ç»ˆç«¯äº¤äº’æ’å…¥åˆ°é¡¹ç›®æ¨¡æ¿ä¸­ï¼Œå®Œå–„äº¤äº’æµç¨‹ã€‚
  * å½“ç„¶ï¼Œäº¤äº’çš„é—®é¢˜ä¸ä»…é™äºæ­¤ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„æƒ…å†µï¼Œæ·»åŠ æ›´å¤šçš„äº¤äº’é—®é¢˜ã€‚`inquirer.js`å¼ºå¤§çš„åœ°æ–¹åœ¨äºï¼Œæ”¯æŒå¾ˆå¤šç§äº¤äº’ç±»å‹ï¼Œé™¤äº†ç®€å•çš„inputï¼Œè¿˜æœ‰`confirm`ã€`list`ã€`password`ã€`checkbox`ç­‰ï¼Œå…·ä½“å¯ä»¥å‚è§é¡¹ç›®çš„å·¥ç¨‹ READMEã€‚ æ­¤å¤–ï¼Œä½ åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `sindresorhus/ora` æ¥æ·»åŠ ä¸€ä¸‹ `Loading` æ•ˆæœã€‚ä½¿ç”¨ `chalk/chalk` ç»™ç»ˆç«¯çš„è¾“å‡ºæ·»åŠ å„ç§æ ·å¼...

#### 4.3.3 æ¨¡ç‰ˆæ–‡ä»¶æ“ä½œ

**æœ€åå°±æ˜¯æ¨¡ç‰ˆæ–‡ä»¶æ“ä½œäº†ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š**

  * å°†è¾“å…¥çš„å†…å®¹æ’å…¥åˆ°æ¨¡æ¿ä¸­
  * æ ¹æ®å‘½ä»¤åˆ›å»ºå¯¹åº”ç›®å½•ç»“æ„ï¼Œcopy æ–‡ä»¶
  * æ›´æ–°å·²å­˜åœ¨æ–‡ä»¶å†…å®¹

> è¿™äº›æ“ä½œåŸºæœ¬éƒ½æ˜¯åœ¨ `/template/index.js` æ–‡ä»¶é‡Œã€‚ è¿™é‡Œè¿˜ç”¨åˆ°äº† `shelljs/shelljs` æ‰§è¡Œ `shell`
> è„šæœ¬ï¼Œå¦‚åˆå§‹åŒ– `Gitï¼š git init`ï¼Œé¡¹ç›®åˆå§‹åŒ–ä¹‹åå®‰è£…ä¾èµ– `npm install`ç­‰

**æ‹·è´æ¨¡æ¿æ–‡ä»¶**

> æ‹·è´æ¨¡ç‰ˆæ–‡ä»¶ä¸»è¦æ˜¯ä½¿ç”¨ `jprichardson/node-fs-extra`çš„ `copyTpl()`æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä½¿ç”¨ `ejs`
> æ¨¡æ¿è¯­æ³•ï¼Œå¯ä»¥å°†è¾“å…¥çš„å†…å®¹æ’å…¥åˆ°æ¨¡ç‰ˆçš„å¯¹åº”ä½ç½®ï¼š
```js
    this.fs.copyTpl(
      project,
      path.join(projectPath, 'project.config.json'),
      {description, projectName}
    );...
```

### 4.4 Taro Build

  * `taro build` å‘½ä»¤æ˜¯æ•´ä¸ª `Taro` é¡¹ç›®çš„çµé­‚å’Œæ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£å¤šç«¯ä»£ç ç¼–è¯‘ï¼ˆH5ï¼Œå°ç¨‹åºï¼Œ`React Native`ç­‰ï¼‰ã€‚
  * `Taro` å‘½ä»¤çš„å…³è”ï¼Œå‚æ•°è§£æç­‰å’Œ `taro init` å…¶å®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œé‚£ä¹ˆæœ€å…³é”®çš„ä»£ç è½¬æ¢éƒ¨åˆ†æ˜¯æ€æ ·å®ç°çš„å‘¢ï¼Ÿ...

#### 4.4.1 ç¼–è¯‘å·¥ä½œæµä¸æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰

> Taro çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯å°†ä»£ç ç¼–è¯‘æˆå…¶ä»–ç«¯ï¼ˆH5ã€å°ç¨‹åºã€React Native
> ç­‰ï¼‰ä»£ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå°†ä¸€ç§ç»“æ„åŒ–è¯­è¨€çš„ä»£ç ç¼–è¯‘æˆå¦ä¸€ç§ç±»ä¼¼çš„ç»“æ„åŒ–è¯­è¨€çš„ä»£ç åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤

![](/images/s_poetries_work_gitee_2020_09_248.png)

é¦–å…ˆæ˜¯ `Parse`ï¼Œå°†ä»£ç è§£æï¼ˆ`Parse`ï¼‰æˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntex Treeï¼‰ï¼Œç„¶åå¯¹
`AST`è¿›è¡Œéå†ï¼ˆ`traverse`ï¼‰å’Œæ›¿æ¢(`replace`)ï¼ˆè¿™å¯¹äºå‰ç«¯æ¥è¯´å…¶å®å¹¶ä¸é™Œç”Ÿï¼Œå¯ä»¥ç±»æ¯” `DOM`
æ ‘çš„æ“ä½œï¼‰ï¼Œæœ€åæ˜¯ç”Ÿæˆï¼ˆ`generate`ï¼‰ï¼Œæ ¹æ®æ–°çš„ `AST` ç”Ÿæˆç¼–è¯‘åçš„ä»£ç ...

#### 4.4.2 Babel æ¨¡å—

`Babel` æ˜¯ä¸€ä¸ªé€šç”¨çš„å¤šåŠŸèƒ½çš„ JavaScriptç¼–è¯‘å™¨ï¼Œæ›´ç¡®åˆ‡åœ°è¯´æ˜¯æºç åˆ°æºç çš„ç¼–è¯‘å™¨ï¼Œé€šå¸¸ä¹Ÿå«åšè½¬æ¢ç¼–è¯‘å™¨ï¼ˆtranspilerï¼‰ã€‚
æ„æ€æ˜¯è¯´ä½ ä¸º Babel æä¾›ä¸€äº› JavaScript ä»£ç ï¼ŒBabel æ›´æ”¹è¿™äº›ä»£ç ï¼Œç„¶åè¿”å›ç»™ä½ æ–°ç”Ÿæˆçš„ä»£ç ...

#### 4.4.3 è§£æé¡µé¢ Config é…ç½®

> åœ¨ä¸šåŠ¡ä»£ç ç¼–è¯‘æˆå°ç¨‹åºçš„ä»£ç è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€æ­¥æ˜¯å°†é¡µé¢å…¥å£ JS çš„ Config å±æ€§è§£æå‡ºæ¥ï¼Œå¹¶å†™å…¥ `*.json`
> æ–‡ä»¶ï¼Œä¾›å°ç¨‹åºä½¿ç”¨ã€‚é‚£ä¹ˆè¿™ä¸€æ­¥æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè¿™é‡Œå°†è¿™éƒ¨åˆ†åŠŸèƒ½çš„å…³é”®ä»£ç æŠ½å–å‡ºæ¥ï¼š
```js
    // 1. babel-traverseæ–¹æ³•ï¼Œ éå†å’Œæ›´æ–°èŠ‚ç‚¹
    traverse(ast, {  
      ClassProperty(astPath) { // éå†ç±»çš„å±æ€§å£°æ˜
        const node = astPath.node
        if (node.key.name === 'config') { // ç±»çš„å±æ€§åä¸º config
          configObj = traverseObjectNode(node)
          astPath.remove() // å°†è¯¥æ–¹æ³•ç§»é™¤æ‰
        }
      }
    })
    
    // 2. éå†ï¼Œè§£æä¸º JSON å¯¹è±¡
    function traverseObjectNode(node, obj) {
      if (node.type === 'ClassProperty' || node.type === 'ObjectProperty') {
        const properties = node.value.properties
          obj = {}
          properties.forEach((p, index) => {
            obj[p.key.name] = traverseObjectNode(p.value)
          })
          return obj
      }
      if (node.type === 'ObjectExpression') {
        const properties = node.properties
        obj = {}
        properties.forEach((p, index) => {
          // const t = require('babel-types')  AST èŠ‚ç‚¹çš„ Lodash å¼å·¥å…·åº“
          const key = t.isIdentifier(p.key) ? p.key.name : p.key.value
          obj[key] = traverseObjectNode(p.value)
        })
        return obj
      }
      if (node.type === 'ArrayExpression') {
        return node.elements.map(item => traverseObjectNode(item))
     ...
```

## äº”ã€Taro ç»„ä»¶åº“åŠ API çš„è®¾è®¡ä¸é€‚é…

### 5.1 å¤šç«¯å·®å¼‚

#### 5.1.1 ç»„ä»¶å·®å¼‚

å°ç¨‹åºã€H5 ä»¥åŠå¿«åº”ç”¨éƒ½å¯ä»¥åˆ’åˆ†ä¸º XML ç±»ï¼ŒReact Native å½’ä¸º JSX ç±»ï¼Œä¸¤ç§è¯­è¨€é£ç‰›é©¬ä¸ç›¸åŠï¼Œç»™é€‚é…è®¾ç½®äº†éå¸¸å¤§çš„éšœç¢ã€‚XML
ç±»æœ‰ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹æ˜¯å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of
Concernsï¼‰ï¼Œå³è¯­ä¹‰å±‚ï¼ˆXMLï¼‰ã€è§†è§‰å±‚ï¼ˆCSSï¼‰ã€äº¤äº’å±‚ï¼ˆJavaScriptï¼‰ä¸‰è€…åˆ†ç¦»çš„æ¾è€¦åˆå½¢å¼ï¼ŒJSX
ç±»åˆ™è¦æŠŠä¸‰è€…æ··ä¸ºä¸€ä½“ï¼Œç”¨è„šæœ¬æ¥åŒ…æ½ä¸‰è€…çš„å·¥ä½œ...

**ä¸åŒç«¯çš„ç»„ä»¶çš„å·®å¼‚è¿˜ä½“ç°åœ¨å®šåˆ¶ç¨‹åº¦ä¸Š**

  * H5 æ ‡ç­¾ï¼ˆç»„ä»¶ï¼‰æä¾›æœ€åŸºç¡€çš„åŠŸèƒ½â€”â€”å¸ƒå±€ã€è¡¨å•ã€åª’ä½“ã€å›¾å½¢ç­‰ç­‰ï¼›
  * å°ç¨‹åºç»„ä»¶ç›¸å¯¹ H5 æœ‰äº†ä¸€å®šç¨‹åº¦çš„å®šåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå°ç¨‹åºç»„ä»¶çœ‹ä½œä¸€å¥—ç±»ä¼¼äº H5 çš„ UI ç»„ä»¶åº“ï¼›
  * React Native ç«¯ç»„ä»¶ä¹ŸåŒæ ·å¦‚æ­¤ï¼Œè€Œä¸”åŸºæœ¬æ˜¯ä¸“â€œç»„â€ä¸“ç”¨çš„ï¼Œæ¯”å¦‚è¦è§¦å‘ç‚¹å‡»äº‹ä»¶å°±å¾—ç”¨ Touchable æˆ–è€… Text ç»„ä»¶ï¼Œè¦æ¸²æŸ“æ–‡æœ¬å°±å¾—ç”¨ Text ç»„ä»¶ï¼ˆè™½ç„¶å°ç¨‹åºä¹Ÿæä¾›äº† Text ç»„ä»¶ï¼Œä½†å®ƒçš„æ–‡æœ¬ä»ç„¶å¯ä»¥ç›´æ¥æ”¾åˆ° view ä¹‹ç±»çš„ç»„ä»¶é‡Œï¼‰...

#### 5.1.2 API å·®å¼‚

**å„ç«¯ API çš„å·®å¼‚å…·æœ‰å®šåˆ¶åŒ–ã€æ¥å£ä¸ä¸€ã€èƒ½åŠ›é™åˆ¶çš„ç‰¹ç‚¹**

  * å®šåˆ¶åŒ–ï¼šå„ç«¯æ‰€æä¾›çš„ API éƒ½æ˜¯ç»è¿‡é‡èº«æ‰“é€ çš„ï¼Œæ¯”å¦‚å°ç¨‹åºçš„å¼€æ”¾æ¥å£ç±» APIï¼Œå®Œå…¨æ˜¯é’ˆå¯¹å°ç¨‹åºæ‰€å¤„çš„å¾®ä¿¡ç¯å¢ƒæ‰“é€ çš„ï¼Œå…¶æä¾›çš„åŠŸèƒ½ä»¥åŠå¤–åœ¨è¡¨ç°éƒ½å·²ç”±æ¡†æ¶æä¾›å®ç°ï¼Œç”¨æˆ·ä¸Šæ‰‹å¯ç”¨ï¼Œæ¯‹é¡»å…³å¿ƒå†…éƒ¨å®ç°ã€‚
  * æ¥å£ä¸ä¸€ï¼šç›¸åŒçš„åŠŸèƒ½ï¼Œåœ¨ä¸åŒç«¯ä¸‹çš„è°ƒç”¨æ–¹å¼ä»¥åŠè°ƒç”¨å‚æ•°ç­‰ä¹Ÿä¸ä¸€æ ·ï¼Œæ¯”å¦‚ `socket`ï¼Œå°ç¨‹åºä¸­ç”¨ `wx.connectSocket` æ¥è¿æ¥ï¼Œ`H5` åˆ™ç”¨ `new WebSocket()` æ¥è¿æ¥ï¼Œè¿™æ ·çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¾ˆå¤šä¸ªã€‚
  * èƒ½åŠ›é™åˆ¶ï¼šå„ç«¯ä¹‹é—´çš„å·®å¼‚å¯ä»¥è¿›è¡Œå®šåˆ¶é€‚é…ï¼Œç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ `API`ï¼ˆæ­¤å¤„ç‰¹æŒ‡å°ç¨‹åº `API`ï¼Œå› ä¸ºå¤šç«¯é€‚é…æ˜¯å‘å°ç¨‹åºçœ‹é½çš„ï¼‰åœ¨å„ä¸ªç«¯éƒ½èƒ½é€šè¿‡å®šåˆ¶é€‚é…æ¥å®ç°ï¼Œå› ä¸ºä¸åŒç«¯æ‰€èƒ½æä¾›çš„ç«¯èƒ½åŠ›â€œå¤§å¼‚å°åŒâ€ï¼Œè¿™æ˜¯åœ¨é€‚é…è¿‡ç¨‹ä¸­ä¸å¯æŠ—æ‹’ã€ä¸å¯æŠ¹å¹³çš„å·®å¼‚...

### 5.2 å¤šç«¯é€‚é…

#### 5.2.1 æ ·å¼å¤„ç†

H5 ç«¯ä½¿ç”¨å®˜æ–¹æä¾›çš„ WEUI è¿›è¡Œé€‚é…ï¼ŒReact Native ç«¯åˆ™åœ¨ç»„ä»¶å†…æ·»åŠ æ ·å¼ï¼Œå¹¶é€šè¿‡è„šæœ¬æ¥æ§åˆ¶ä¸€äº›çŠ¶æ€ç±»çš„æ ·å¼ï¼Œæ¡†æ¶æ ¸å¿ƒåœ¨ç¼–è¯‘çš„æ—¶å€™æŠŠæºä»£ç çš„
class æ‰€æŒ‡å‘çš„æ ·å¼é€šè¿‡ css-to-react-native è¿›è¡Œè½¬è¯‘ï¼Œæ‰€å¾— StyleSheet æ ·å¼ä¼ å…¥ç»„ä»¶çš„ style
å‚æ•°ï¼Œç»„ä»¶å†…éƒ¨ä¼šå¯¹æ ·å¼è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ ·å¼...

![](/images/s_poetries_work_gitee_2020_09_248.png)

**ä¸ºä»€ä¹ˆéœ€è¦å¯¹æ ·å¼è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Ÿ**

> éƒ¨åˆ†ç»„ä»¶æ˜¯ç›´æ¥æŠŠä¼ å…¥ `style` çš„æ ·å¼èµ‹ç»™æœ€å¤–å±‚çš„ `React Native`
> åŸç”Ÿç»„ä»¶ï¼Œä½†éƒ¨åˆ†ç»è¿‡å±‚å±‚å°è£…çš„ç»„ä»¶åˆ™ä¸ç„¶ï¼Œæˆ‘ä»¬è¦æŠŠå®¹å™¨æ ·å¼ã€å†…éƒ¨æ ·å¼å’Œæ–‡æœ¬æ ·å¼ç¦»æã€‚ä¸ºäº†æ–¹ä¾¿è§£é‡Šï¼Œæˆ‘ä»¬æŠŠè¿™ç±»ç»„ä»¶ç®€åŒ–ä¸ºä»¥ä¸‹çš„å½¢å¼ï¼š
```javascript
    <View style={wrapperStyle}>
      <View style={containerStyle}>
        <Text style={textStyle}>Hello World</Text>
      </View>
    </View>
```

> å‡è®¾ç»„ä»¶æœ‰æ ·å¼ `margin-top`ã€`background-color` å’Œ `font-
> size`ï¼Œè½¬è¯‘ä¼ å…¥ç»„ä»¶åï¼Œå°±è¦æŠŠåˆ†åˆ«æŠŠå®ƒä»¬ä¼ åˆ°`wrapperStyle`ã€`containerStyle` å’Œ `textStyle`ï¼Œå¯å‚è€ƒ
> `ScrollView` çš„ `style` å’Œ `contentContainerStyle`...

#### 5.2.2 ç»„ä»¶å°è£…

> ç»„ä»¶çš„å°è£…åˆ™æ˜¯ä¸€ä¸ªâ€œä»¿åˆ¶â€çš„è¿‡ç¨‹ï¼Œåˆ©ç”¨ç«¯æä¾›çš„åŸææ–™ï¼ŒåŠ å·¥æˆé€šç”¨çš„ç»„ä»¶ï¼Œæš´éœ²ç›¸å¯¹ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼ã€‚æˆ‘ä»¬ç”¨ `<Button />`
> è¿™ä¸ªç»„ä»¶æ¥ä¸¾ä¾‹ï¼Œåœ¨å°ç¨‹åºç«¯å®ƒä¹Ÿè®¸æ˜¯é•¿è¿™æ ·å­çš„
```javascript
    <button size="mini" plain={{plain}} loading={{loading}} hover-class="you-hover-me"></button>
```

> å¦‚æœè¦å®ç° `H5` ç«¯è¿™ä¹ˆä¸€ä¸ªæŒ‰é’®ï¼Œå¤§æ¦‚ä¼šåƒä¸‹é¢è¿™æ ·ï¼Œåœ¨ç»„ä»¶å†…éƒ¨æŠŠå°ç¨‹åºçš„æŒ‰é’®ç‰¹æ€§å®ç°ä¸€éï¼Œç„¶åæš´éœ²è·Ÿå°ç¨‹åºä¸€è‡´çš„è°ƒç”¨æ–¹å¼ï¼Œå°±å®Œæˆäº† `H5`
> ç«¯ä¸€ä¸ªç»„ä»¶çš„è®¾è®¡
```html
    <button
      {...omit(this.props, ['hoverClass', 'onTouchStart', 'onTouchEnd'])}
      className={cls}
      style={style}
      onClick={onClick}
      disabled={disabled}
      onTouchStart={_onTouchStart}
      onTouchEnd={_onTouchEnd}
    >
      {loading && <i class='weui-loading' />}
      {children}
    </button>...
```

  * å…¶ä»–ç«¯çš„ç»„ä»¶é€‚é…ç›¸å¯¹ H5 ç«¯æ¥è¯´ä¼šæ›´æ›²æŠ˜å¤æ‚ä¸€äº›ï¼Œå› ä¸º H5 è·Ÿå°ç¨‹åºçš„è¯­è¨€è¾ƒä¸ºç›¸ä¼¼ï¼Œè€Œå…¶ä»–ç«¯éœ€è¦æ•´åˆç‰¹å®šç«¯çš„å„ç§ç»„ä»¶ï¼Œä»¥åŠåˆ©ç”¨ç«¯ç»„ä»¶çš„ç‰¹æ€§æ¥å®ç°ï¼Œæ¯”å¦‚åœ¨ React Native ä¸­å®ç°è¿™ä¸ªæŒ‰é’®ï¼Œåˆ™éœ€è¦ç”¨åˆ° `<Touchable* />`ã€`<View />`ã€`<Text />`ï¼Œè¦å®ç°åŠ¨ç”»åˆ™éœ€è¦ç”¨ä¸Š `<Animated.View />`ï¼Œè¿˜æœ‰å°±æ˜¯ç›¸å¯¹äº H5 å’Œå°ç¨‹åºæ¯”è¾ƒå®¹æ˜“å®ç°çš„ touch äº‹ä»¶ï¼Œåœ¨ React Native ä¸­åˆ™éœ€è¦ç”¨ä¸Š PanResponder æ¥è¿›è¡Œâ€œä»¿çœŸâ€ï¼Œæ€»ä¹‹å°±æ˜¯ï¼Œå› â€œç«¯â€åˆ¶å®œï¼Œä¸€åˆ‡ä¸ºäº†æœ€ååªéœ€ä¸€è¡Œä»£ç é€šè¡Œå¤šç«¯ï¼
  * é™¤äº†å±æ€§æ”¯æŒå¤–ï¼Œäº‹ä»¶å›è°ƒçš„å‚æ•°ä¹Ÿéœ€è¦è¿›è¡Œç»Ÿä¸€ï¼Œä¸ºæ­¤ï¼Œéœ€è¦åœ¨å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ Input çš„ `onInput` äº‹ä»¶ï¼Œéœ€è¦ç»™å®ƒé€ ä¸€ä¸ªç±»ä¼¼å°ç¨‹åºç›¸åŒäº‹ä»¶çš„å›è°ƒå‚æ•°ï¼Œæ¯”å¦‚ `{ target: { value: text }`, `detail: { value: text }` }ï¼Œè¿™æ ·ï¼Œå¼€å‘è€…ä»¬å°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å¤„ç†å›è°ƒäº‹ä»¶ï¼Œæ— éœ€å…³å¿ƒä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆ...
```js
    function onInputHandler ({ target, detail }) {
      console.log(target.value, detail.value)
    }
```

## å…­ã€JSX è½¬æ¢å¾®ä¿¡å°ç¨‹åºæ¨¡æ¿çš„å®ç°

### 6.1 ä»£ç çš„æœ¬è´¨

> ä¸ç®¡æ˜¯ä»»æ„è¯­è¨€çš„ä»£ç ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰ä¸¤ä¸ªå…±åŒç‚¹

  * å®ƒä»¬éƒ½æ˜¯ç”±å­—ç¬¦ä¸²æ„æˆçš„æ–‡æœ¬
  * å®ƒä»¬éƒ½è¦éµå¾ªè‡ªå·±çš„è¯­è¨€è§„èŒƒ

ç¬¬ä¸€ç‚¹å¾ˆå¥½ç†è§£ï¼Œæ—¢ç„¶ä»£ç æ˜¯å­—ç¬¦ä¸²æ„æˆçš„ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹/ç¼–è¯‘ä»£ç çš„æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²çš„å„ç§æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¾‹å¦‚æˆ‘ä»¬è¦å°† `JSON` ä¸­ä¸€ä¸ªé”®å `foo`
æ”¹ä¸º `bar`ï¼Œåªè¦å†™ä¸€ä¸ªç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼å°±èƒ½åšåˆ°ï¼š
```javascript
    jsonStr.replace(/(?<=")foo(?="\s*:)/i, 'bar')...
```

> ç¼–è¯‘å°±æ˜¯æŠŠä¸€æ®µå­—ç¬¦ä¸²æ”¹æˆå¦å¤–ä¸€æ®µå­—ç¬¦ä¸²

### 6.2 Babel

> `JavaScript` ç¤¾åŒºå…¶å®æœ‰éå¸¸å¤š `parser` å®ç°ï¼Œæ¯”å¦‚
> `Acorn`ã€`Esprima`ã€`Recast`ã€`Traceur`ã€`Cherow` ç­‰ç­‰ã€‚ä½†æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨ `Babel`ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› 

  * `Babel` å¯ä»¥è§£æè¿˜æ²¡æœ‰è¿›å…¥ ECMAScript è§„èŒƒçš„è¯­æ³•ã€‚ä¾‹å¦‚è£…é¥°å™¨è¿™æ ·çš„ææ¡ˆï¼Œè™½ç„¶ç°åœ¨æ²¡æœ‰è¿›å…¥æ ‡å‡†ä½†æ˜¯å·²ç»å¹¿æ³›ä½¿ç”¨æœ‰ä¸€æ®µæ—¶é—´äº†ï¼›
  * `Babel` æä¾›æ’ä»¶æœºåˆ¶è§£æ `TypeScript`ã€`Flow`ã€`JSX`è¿™æ ·çš„ `JavaScript` è¶…é›†ï¼Œä¸å¿…å•ç‹¬å¤„ç†è¿™äº›è¯­è¨€ï¼›
  * `Babel` æ‹¥æœ‰åºå¤§çš„ç”Ÿæ€ï¼Œæœ‰éå¸¸å¤šçš„æ–‡æ¡£å’Œæ ·ä¾‹ä»£ç å¯ä¾›å‚è€ƒï¼› é™¤å» `parser` æœ¬èº«ï¼Œ`Babel` è¿˜æä¾›å„ç§æ–¹ä¾¿çš„å·¥å…·åº“å¯ä»¥ä¼˜åŒ–ã€ç”Ÿæˆã€è°ƒè¯•ä»£ç ...

**Babylonï¼ˆ @babel/parserï¼‰**

> `Babylon` å°±æ˜¯ `Babel` çš„ `parser`ã€‚å®ƒå¯ä»¥æŠŠä¸€æ®µç¬¦åˆè§„èŒƒçš„ JavaScript ä»£ç è¾“å‡ºæˆä¸€ä¸ªç¬¦åˆ Esprima è§„èŒƒçš„
> `AST`ã€‚ å¤§éƒ¨åˆ† `parser` ç”Ÿæˆçš„ `AST` æ•°æ®ç»“æ„éƒ½éµå¾ª Esprima è§„èŒƒï¼ŒåŒ…æ‹¬ ESLint çš„ `parser`
> ESTreeã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬ç†Ÿæ‚‰äº† Esprima è§„èŒƒçš„ `AST` æ•°æ®ç»“æ„è¿˜èƒ½å»å†™ ESLint æ’ä»¶ã€‚

æˆ‘ä»¬å¯ä»¥å°è¯•è§£æ `n * n` è¿™å¥ç®€å•çš„è¡¨è¾¾å¼ï¼š
```js
    import * as babylon from "babylon";
    
    const code = `n * n`;
    
    babylon.parse(code);...
```

æœ€ç»ˆ `Babylon` ä¼šè§£ææˆè¿™æ ·çš„æ•°æ®ç»“æ„ï¼š

![](/images/s_poetries_work_gitee_2020_09_250.png)

> ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [ASTExploroer (opens new window)](https://astexplorer.net/) å¿«é€Ÿåœ°æŸ¥çœ‹ä»£ç çš„
> `AST`

**Babel-traverse (@babel/traverse)**

> `babel-traverse` å¯ä»¥éå†ç”± Babylon
> ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå¹¶æŠŠæŠ½è±¡è¯­æ³•æ ‘çš„å„ä¸ªèŠ‚ç‚¹ä»æ‹“æ‰‘æ•°æ®ç»“æ„è½¬åŒ–æˆä¸€é¢—è·¯å¾„ï¼ˆPathï¼‰æ ‘ï¼ŒPath
> è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿æ¥çš„å“åº”å¼ï¼ˆReactiveï¼‰å¯¹è±¡ï¼Œå®ƒæ‹¥æœ‰æ·»åŠ ã€åˆ é™¤ã€æ›¿æ¢èŠ‚ç‚¹ç­‰æ–¹æ³•ã€‚å½“ä½ è°ƒç”¨è¿™äº›ä¿®æ”¹æ ‘çš„æ–¹æ³•ä¹‹åï¼Œè·¯å¾„ä¿¡æ¯ä¹Ÿä¼šè¢«æ›´æ–°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒPath
> è¿˜æä¾›äº†ä¸€äº›æ“ä½œä½œç”¨åŸŸï¼ˆScopeï¼‰ å’Œæ ‡è¯†ç¬¦ç»‘å®šï¼ˆIdentifier Bindingï¼‰ çš„æ–¹æ³•å¯ä»¥å»åšå¤„ç†ä¸€äº›æ›´ç²¾ç»†å¤æ‚çš„éœ€æ±‚ã€‚å¯ä»¥è¯´
> `babel-traverse` æ˜¯ä½¿ç”¨ Babel ä½œä¸ºç¼–è¯‘å™¨æœ€æ ¸å¿ƒçš„æ¨¡å—...

è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹æŠŠä¸€æ®µä»£ç ä¸­çš„ `n * n` å˜ä¸º `x * x`
```js
    import * as babylon from "@babel/parser";
    import traverse from "babel-traverse";
    
    const code = `function square(n) {
      return n * n;
    }`;
    
    const ast = babylon.parse(code);
    
    traverse(ast, {
      enter(path) {
        if (
          path.node.type === "Identifier" &&
          path.node.name === "n"
        ) {
          path.node.name = "x";
        }
      }
    });...
```

**Babel-typesï¼ˆ@babel/typesï¼‰**

> `babel-types` æ˜¯ä¸€ä¸ªç”¨äº `AST` èŠ‚ç‚¹çš„ `Lodash` å¼å·¥å…·åº“ï¼Œå®ƒåŒ…å«äº†æ„é€ ã€éªŒè¯ä»¥åŠå˜æ¢ `AST`èŠ‚ç‚¹çš„æ–¹æ³•ã€‚
> è¯¥å·¥å…·åº“åŒ…å«è€ƒè™‘å‘¨åˆ°çš„å·¥å…·æ–¹æ³•ï¼Œå¯¹ç¼–å†™å¤„ç† `AST` é€»è¾‘éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨ `babel-traverse`ä¸­æ”¹å˜æ ‡è¯†ç¬¦ n
> çš„ä»£ç å¯ä»¥ç®€å†™ä¸ºï¼š
```javascript
    import traverse from "babel-traverse";
    import * as t from "babel-types";
    
    traverse(ast, {
      enter(path) {
        if (t.isIdentifier(path.node, { name: "n" })) {
          path.node.name = "x";
        }
      }
    });
```

> å¯ä»¥å‘ç°ä½¿ç”¨ `babel-types`èƒ½æé«˜æˆ‘ä»¬è½¬æ¢ä»£ç çš„å¯è¯»æ€§ï¼Œåœ¨é…åˆ TypeScript è¿™æ ·çš„é™æ€ç±»å‹è¯­è¨€åï¼Œ`babel-types`
> çš„æ–¹æ³•è¿˜èƒ½æä¾›ç±»å‹æ ¡éªŒçš„åŠŸèƒ½ï¼Œèƒ½æœ‰æ•ˆåœ°æé«˜æˆ‘ä»¬è½¬æ¢ä»£ç çš„å¥å£®æ€§å’Œå¯é æ€§...

### 6.3 å®è·µä¾‹å­

ä»¥ä¸€ä¸ªç®€å• `Page` é¡µé¢ä¸ºä¾‹ï¼š
```js
    import Taro, { Component } from '@tarojs/taro'
    import { View, Text } from '@tarojs/components'
    
    class Home extends Component {
    
      config = {
        navigationBarTitleText: 'é¦–é¡µ'
      }
    
      state = {
        numbers: [1, 2, 3, 4, 5]
      }
    
      handleClick = () => {
        this.props.onTest()
      }
    
      render () {
        const oddNumbers = this.state.numbers.filter(number => number & 2)
        return (
          <ScrollView className='home' scrollTop={false}>
            å¥‡æ•°ï¼š
            {
              oddNumbers.map(number => <Text onClick={this.handleClick}>{number}</Text>)
            }
            å¶æ•°ï¼š
            {
              numbers.map(number => number % 2 === 0 && <Text onClick={this.handleClick}>{number}</Text>)
            }
          </ScrollView>
        )
      }
    }...
```

#### 6.3.1 è®¾è®¡æ€è·¯

  * Taro çš„ç»“æ„ä¸»è¦åˆ†ä¸¤ä¸ªæ–¹é¢ï¼šè¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶ã€‚è¿è¡Œæ—¶è´Ÿè´£æŠŠç¼–è¯‘ååˆ°ä»£ç è¿è¡Œåœ¨æœ¬ä¸èƒ½è¿è¡Œçš„å¯¹åº”ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥æŠŠ Taro è¿è¡Œæ—¶ç†è§£ä¸ºå‰ç«¯å¼€å‘å½“ä¸­ `polyfill`ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå°ç¨‹åºæ–°å»ºä¸€ä¸ªé¡µé¢æ˜¯ä½¿ç”¨ `Page` æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå­—é¢é‡å¯¹è±¡ï¼Œå¹¶ä¸æ”¯æŒä½¿ç”¨ç±»ã€‚å¦‚æœå…¨éƒ¨ä¾èµ–ç¼–è¯‘æ—¶çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšåˆ°äº‹æƒ…å¤§æ¦‚å°±æ˜¯æŠŠç±»è½¬åŒ–æˆå¯¹è±¡ï¼ŒæŠŠ `state` å˜ä¸º `data`ï¼ŒæŠŠç”Ÿå‘½å‘¨æœŸä¾‹å¦‚ componentDidMount è½¬åŒ–æˆ `onReady`ï¼ŒæŠŠäº‹ä»¶ç”±å¯èƒ½çš„ç±»å‡½æ•°ï¼ˆ`Class method`ï¼‰å’Œç±»å±æ€§å‡½æ•°(`Class property function`) è½¬åŒ–æˆå­—é¢é‡å¯¹è±¡æ–¹æ³•ï¼ˆObject `property function`ï¼‰ç­‰ç­‰ã€‚
  * ä½†è¿™æ˜¾ç„¶ä¼šè®©æˆ‘ä»¬çš„ç¼–è¯‘æ—¶å·¥ä½œå˜å¾—éå¸¸ç¹é‡ï¼Œåœ¨ä¸€ä¸ªç±»å¼‚å¸¸å¤æ‚æ—¶å‡ºé”™çš„æ¦‚ç‡ä¹Ÿä¼šå˜é«˜ã€‚ä½†æˆ‘ä»¬æœ‰æ›´å¥½çš„åŠæ³•ï¼šå®ç°ä¸€ä¸ª `createPage` æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªç±»ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå°ç¨‹åº `Page` æ–¹æ³•æ‰€éœ€è¦çš„å­—é¢é‡å¯¹è±¡ã€‚è¿™æ ·ä¸ä»…ç®€åŒ–äº†ç¼–è¯‘æ—¶çš„å·¥ä½œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ `createPage` å¯¹ç¼–è¯‘æ—¶äº§å‡ºçš„ç±»åšå„ç§æ“ä½œå’Œä¼˜åŒ–ã€‚é€šè¿‡è¿è¡Œæ—¶æŠŠå·¥ä½œåˆ†ç¦»äº†ä¹‹åï¼Œå†ç¼–è¯‘æ—¶æˆ‘ä»¬åªéœ€è¦åœ¨æ–‡ä»¶åº•éƒ¨åŠ ä¸Šä¸€è¡Œä»£ç  `Page(createPage(componentName))` å³å¯...

![](/images/s_poetries_work_gitee_2020_09_251.png)

  * å›åˆ°ä¸€å¼€å§‹é‚£æ®µä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å±æ€§ `config`ï¼Œ`config` æ˜¯ä¸€ä¸ªå¯¹è±¡è¡¨è¾¾å¼ï¼ˆObject Expressionï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡è¡¨è¾¾å¼åªæ¥å—é”®å€¼ä¸ºæ ‡è¯†ç¬¦ï¼ˆIdentifierï¼‰æˆ–å­—ç¬¦ä¸²ï¼Œè€Œé”®ååªèƒ½æ˜¯åŸºæœ¬ç±»å‹ã€‚è¿™æ ·ç®€å•çš„æƒ…å†µæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªå¯¹è±¡è¡¨è¾¾å¼è½¬æ¢ä¸º `JSON` å³å¯ã€‚å¦å¤–ä¸€ä¸ªç±»å±æ€§ `state` åœ¨ `Page` å½“ä¸­æœ‰ç‚¹åƒæ˜¯å°ç¨‹åºçš„ `data`ï¼Œä½†å®ƒåœ¨å¤šæ•°æƒ…å†µä¸æ˜¯å®Œæ•´çš„ `data`ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ç”¨åšè¿‡å¤šçš„æ“ä½œï¼Œ`babel`çš„æ’ä»¶ `transform-class-proerties` ä¼šæŠŠå®ƒç¼–è¯‘åˆ°ç±»çš„æ„é€ å™¨ä¸­ã€‚å‡½æ•° `handleClick` æˆ‘ä»¬äº¤ç»™è¿è¡Œæ—¶å¤„ç†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è·³åˆ° Taro è¿è¡Œæ—¶åŸç†æŸ¥çœ‹å…·ä½“æŠ€æœ¯ç»†èŠ‚ã€‚
  * å†æ¥çœ‹æˆ‘ä»¬çš„ `render()`å‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€è¡Œä»£ç é€šè¿‡ `filter` æŠŠæ•°å­—æ•°ç»„çš„æ‰€æœ‰å¶æ•°é¡¹éƒ½è¿‡æ»¤æ‰ï¼ŒçœŸæ­£ç”¨æ¥å¾ªç¯çš„æ˜¯ `oddNumbers`ï¼Œè€Œ `oddNumbers` å¹¶æ²¡æœ‰åœ¨ `this.state` ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨æŠŠå®ƒåŠ å…¥åˆ° `this.state`ã€‚å’Œ `React ä¸€æ ·ï¼ŒTaro æ¯æ¬¡æ›´æ–°éƒ½ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œä½†å’Œ React ä¸åŒçš„æ˜¯ï¼ŒReact çš„ render` æ˜¯ä¸€ä¸ªåˆ›å»ºè™šæ‹Ÿ DOM çš„æ–¹æ³•ï¼Œè€Œ Taro çš„ render ä¼šè¢«é‡å‘½åä¸º `_createData`ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ›å»ºæ•°æ®çš„æ–¹æ³•ï¼šåœ¨ `JSX` ä½¿ç”¨è¿‡çš„æ•°æ®éƒ½åœ¨è¿™é‡Œè¢«åˆ›å»ºæœ€åæ”¾åˆ°å°ç¨‹åº `Page` æˆ– `Component` å·¥å‚æ–¹æ³•ä¸­çš„ `data`ã€‚æœ€ç»ˆæˆ‘ä»¬çš„ `render` æ–¹æ³•ä¼šè¢«ç¼–è¯‘ä¸º...
```js
    _createData() {
      this.__state = arguments[0] || this.state || {};
      this.__props = arguments[1] || this.props || {};
    
      const oddNumbers = this.__state.numbers.filter(number => number & 2);
      Object.assign(this.__state, {
        oddNumbers: oddNumbers
      });
      return this.__state;
    }...
```

#### 6.3.2 WXML å’Œ JSX

åœ¨ Taro é‡Œ `render` çš„æ‰€æœ‰ `JSX`å…ƒç´ éƒ½ä¼šåœ¨ JavaScript æ–‡ä»¶ä¸­è¢«ç§»é™¤ï¼Œå®ƒä»¬æœ€ç»ˆå°†ä¼šç¼–è¯‘æˆå°ç¨‹åºçš„ `WXML`ã€‚æ¯ä¸ª
`WXML` å…ƒç´ å’Œ `HTML` å…ƒç´ ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå®šä¹‰ä¸ºä¸‰ç§ç±»å‹ï¼š`Element`ã€`Text`ã€`Comment`ã€‚å…¶ä¸­ `Text`
åªæœ‰ä¸€ä¸ªå±æ€§: å†…å®¹ï¼ˆ`content`ï¼‰ï¼Œå®ƒå¯¹åº”çš„ `AST` ç±»å‹æ˜¯ `JSXText`ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å‰æ–‡æºç ä¸­å¯¹åº”å­—ç¬¦ä¸²çš„å¥‡æ•°å’Œå¶æ•°è½¬æ¢æˆ Text
å³å¯ã€‚è€Œå¯¹äº `Comment`è€Œè¨€æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨æ¸…é™¤ï¼Œä¸å‚ä¸ WXML çš„ç¼–è¯‘ã€‚Element
ç±»å‹æœ‰å®ƒçš„åå­—ï¼ˆ`tagName`ï¼‰ã€`children`ã€å±æ€§ï¼ˆ`attributes`ï¼‰ï¼Œå…¶ä¸­ `children` å¯èƒ½æ˜¯ä»»æ„ `WXML`
ç±»å‹ï¼Œå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé”®å€¼å’Œé”®åéƒ½æ˜¯å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°†æŠŠé‡ç‚¹æ”¾åœ¨å¦‚ä½•è½¬æ¢æˆä¸º `WXML` çš„ `Element`ç±»å‹ã€‚

é¦–å…ˆæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ `<View className='home'>`ï¼Œå®ƒåœ¨ `AST`ä¸­æ˜¯ä¸€ä¸ª `JSXElementï¼Œå®ƒçš„ç»“æ„å’Œæˆ‘ä»¬å®šä¹‰`Element
`ç±»å‹å·®ä¸å¤šã€‚æˆ‘ä»¬å…ˆå°† JSXElement çš„`ScrollView ä»é©¼å³°å¼çš„ JSX å‘½åè½¬åŒ–ä¸ºçŸ­æ¨ªçº¿ï¼ˆkebab caseï¼‰é£æ ¼ï¼ŒclassName
å’Œ `scrollTop`çš„å€¼åˆ†åˆ«ä»£è¡¨äº† `JSXAttribute` å€¼çš„ä¸¤ç§ç±»å‹ï¼š`StringLiteral` å’Œ
`JSXExpressionContainer`ï¼Œ`className` æ˜¯ç®€å•çš„ `StringLiteral` å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œ`scrollTop`
å¤„ç†èµ·æ¥ç¨å¾®éº»çƒ¦ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸¤ä¸ªèŠ±æ‹¬å·`{}` æŠŠå†…å®¹åŒ…èµ·æ¥...

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ€è€ƒä¸€ä¸‹æ¯ä¸€ä¸ª JSXElement
å‡ºç°çš„ä½ç½®ï¼Œä½ å¯ä»¥å‘ç°å…¶å®å®ƒçš„çˆ¶å…ƒç´ åªæœ‰å‡ ç§å¯èƒ½æ€§ï¼šreturnã€å¾ªç¯ã€æ¡ä»¶ï¼ˆé€»è¾‘ï¼‰è¡¨è¾¾å¼ã€‚è€Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æåˆ°ï¼Œbabel-traverse éå†çš„
AST ç±»å‹æ˜¯å“åº”å¼çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬æŒ‰ç…§ JSXElement çˆ¶å…ƒç´ ç±»å‹çš„é¡ºåºç©·ä¸¾å¤„ç†è¿™å‡ ç§å¯èƒ½æ€§ï¼ŒæŠŠå„ç§å¯èƒ½æ€§å¤§ç»“æœåº”ç”¨åˆ° JSX
å…ƒç´ ä¹‹ååˆ é™¤æ‰åŸæ¥çš„è¡¨è¾¾å¼ï¼Œæœ€åå°±å¯ä»¥æŠŠä¸€ä¸ªå¤æ‚çš„ JSX è¡¨è¾¾å¼è½¬æ¢ä¸ºä¸€ä¸ªç®€å•çš„ WXML æ•°æ®ç»“æ„ã€‚...

æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€ä¸ªå¾ªç¯ï¼š
```javascript
    oddNumbers.map(number => <Text onClick={this.handleClick}>{number}</Text>)
```

Text çš„çˆ¶å…ƒç´ æ˜¯ä¸€ä¸ª map å‡½æ•°ï¼ˆCallExpressionï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°çš„ callee: oddNumbers ä½œä¸º wx:for
çš„å€¼ï¼Œå¹¶æŠŠå®ƒæ”¾åˆ° state ä¸­ï¼ŒåŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ wx:for-itemçš„å€¼ï¼Œå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°åº”è¯¥æ˜¯ wx:for-index
çš„å€¼ï¼Œä½†ä»£ç ä¸­æ²¡æœ‰ä¼ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ç®¡å®ƒã€‚ç„¶åæˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ª wx: å¼€å¤´çš„å‚æ•°ä½œä¸º attribute ä¼ å…¥ Text å…ƒç´ å°±å®Œæˆäº†å¾ªç¯çš„å¤„ç†ã€‚è€Œå¯¹äº
onClick è€Œè¨€ï¼Œåœ¨ Taro ä¸­ on å¼€å¤´çš„å…ƒç´ å‚æ•°éƒ½æ˜¯äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æŠŠ this. å»æ‰å³å¯ã€‚Text å…ƒç´ çš„ children æ˜¯ä¸€ä¸ª
JSXExpressionContainerï¼Œæˆ‘ä»¬æŒ‰ç…§ä¹‹å‰çš„å¤„ç†æ–¹å¼å¤„ç†å³å¯ã€‚æœ€åè¿™è¡Œæˆ‘ä»¬ç”Ÿæˆå‡ºæ¥çš„æ•°æ®ç»“æ„åº”è¯¥æ˜¯è¿™æ ·...
```js
    {
      type: 'element',
      tagName: 'text',
      attributes: [
        { bindtap: 'handleClick' },
        { 'wx:for': '{{oddNumbers}}' },
        { 'wx:for-item': 'number' }
      ],
      children: [
        { type: 'text', content: '{{number}}' }
      ]
    }...
```

æœ‰äº†è¿™ä¸ªæ•°æ®ç»“æ„ç”Ÿæˆä¸€æ®µ WXML å°±éå¸¸ç®€å•äº†

å†æ¥çœ‹ç¬¬äºŒä¸ªå¾ªç¯è¡¨è¾¾å¼ï¼š
```javascript
    numbers.map(number => number % 2 === 0 && <Text onClick={this.handleClick}>{number}</Text>)...
```

å®ƒæ¯”ç¬¬ä¸€ä¸ªå¾ªç¯è¡¨è¾¾å¼å¤šäº†ä¸€ä¸ªé€»è¾‘è¡¨è¾¾å¼ï¼ˆLogical Operatorsï¼‰ï¼Œæˆ‘ä»¬çŸ¥é“ expr1 && expr2 æ„å‘³ç€å¦‚æœ expr1 èƒ½è½¬æ¢æˆ
true åˆ™è¿”å› expr2ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦æŠŠ number % 2 === 0 ä½œä¸ºå€¼ç”Ÿæˆä¸€ä¸ªé”®å wx:if çš„ JSXAttribute
å³å¯ã€‚ä½†ç”±äº wx:if å’Œ wx:for åŒæ—¶ä½œç”¨äºä¸€ä¸ªå…ƒç´ å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç”Ÿæˆä¸€ä¸ª block å…ƒç´ ï¼ŒæŠŠ wx:if æŒ‚è½½åˆ° block
å…ƒç´ ï¼ŒåŸå…ƒç´ åˆ™å…¨éƒ¨ä½œä¸º children ä¼ å…¥ block å…ƒç´ ä¸­ã€‚è¿™æ—¶ babel-traverse ä¼šæ£€æµ‹åˆ°æ–°çš„å…ƒç´  blockï¼Œå®ƒçš„çˆ¶å…ƒç´ æ˜¯ä¸€ä¸ª
map å¾ªç¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ç¬¬ä¸€ä¸ªå¾ªç¯è¡¨è¾¾å¼çš„å¤„ç†æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªè¡¨è¾¾å¼ã€‚

è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ `this.props.text || this.props.children` çš„è§£å†³æ–¹æ¡ˆã€‚å½“ç”¨æˆ·åœ¨ JSX ä¸­ä½¿ç”¨ ||
ä½œä¸ºé€»è¾‘è¡¨è¾¾å¼æ—¶å¾ˆå¯èƒ½æ˜¯ this.props.text å’Œ this.props.children éƒ½æœ‰å¯èƒ½ä½œä¸ºç»“æœè¿”å›ã€‚è¿™é‡Œ Taro å°†å®ƒç¼–è¯‘æˆäº†
`this.props.text ? this.props.text:
this.props.children`ï¼ŒæŒ‰ç…§æ¡ä»¶è¡¨è¾¾å¼ï¼ˆä¸‰å…ƒè¡¨è¾¾å¼ï¼‰çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šç”Ÿæˆä¸¤ä¸ª blockï¼Œä¸€ä¸ª `wx:if` å’Œä¸€ä¸ª
`wx:else`ï¼š
```js
    <block wx:if="{{text}}">{{text}}</block>
    <block wx:else>
        <slot></slot>
    </block>
```

## ä¸ƒã€å°ç¨‹åºè¿è¡Œæ—¶

ä¸ºäº†ä½¿ `Taro` ç»„ä»¶è½¬æ¢æˆå°ç¨‹åºç»„ä»¶å¹¶è¿è¡Œåœ¨å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œ `Taro` ä¸»è¦åšäº†ä¸¤ä¸ªæ–¹é¢çš„å·¥ä½œï¼šç¼–è¯‘ä»¥åŠè¿è¡Œæ—¶é€‚é…ã€‚ç¼–è¯‘è¿‡ç¨‹ä¼šåšå¾ˆå¤šå·¥ä½œï¼Œä¾‹å¦‚ï¼šå°†
JSX è½¬æ¢æˆå°ç¨‹åº `.wxml`
æ¨¡æ¿ï¼Œç”Ÿæˆå°ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€é¡µé¢åŠç»„ä»¶çš„ä»£ç ç­‰ç­‰ã€‚ç¼–è¯‘ç”Ÿæˆå¥½çš„ä»£ç ä»ç„¶ä¸èƒ½ç›´æ¥è¿è¡Œåœ¨å°ç¨‹åºç¯å¢ƒé‡Œï¼Œé‚£è¿è¡Œæ—¶åˆæ˜¯å¦‚ä½•ä¸ä¹‹ååŒå·¥ä½œçš„å‘¢ï¼Ÿ...

### 7.1 æ³¨å†Œç¨‹åºã€é¡µé¢ä»¥åŠè‡ªå®šä¹‰ç»„ä»¶

åœ¨å°ç¨‹åºä¸­ä¼šåŒºåˆ†ç¨‹åºã€é¡µé¢ä»¥åŠç»„ä»¶ï¼Œé€šè¿‡è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œå¹¶ä¼ å…¥åŒ…å«ç”Ÿå‘½å‘¨æœŸå›è°ƒã€äº‹ä»¶å¤„ç†å‡½æ•°ç­‰é…ç½®å†…å®¹çš„ object å‚æ•°æ¥è¿›è¡Œæ³¨å†Œï¼š
```js
    Component({
      data: {},
      methods: {
        handleClick () {}
      }
    })
```

è€Œåœ¨ `Taro`é‡Œï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªç»„ä»¶ç±»ï¼š
```js
    class CustomComponent extends Component {
      state = { }
      handleClick () { }
    }...
```

  * é‚£ä¹ˆ `Taro` çš„ç»„ä»¶ç±»æ˜¯å¦‚ä½•è½¬æ¢æˆå°ç¨‹åºçš„ç¨‹åºã€é¡µé¢æˆ–ç»„ä»¶çš„å‘¢ï¼Ÿ
  * ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç»„ä»¶ï¼š`customComponent`ï¼Œç¼–è¯‘è¿‡ç¨‹ä¼šåœ¨ç»„ä»¶åº•éƒ¨æ·»åŠ ä¸€è¡Œè¿™æ ·çš„ä»£ç ï¼ˆæ­¤å¤„ä»£ç ä½œç¤ºä¾‹ç”¨ï¼Œä¸å®é™…é¡¹ç›®ç”Ÿæˆçš„ä»£ç ä¸å°½ç›¸åŒï¼‰ï¼š
```javascript
    Component(createComponent(customComponent))
```

  * `createComponent` æ–¹æ³•æ˜¯æ•´ä¸ªè¿è¡Œæ—¶çš„å…¥å£ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„ç»„ä»¶ç±»ï¼Œè¿”å›ä¸€ä¸ªç»„ä»¶çš„é…ç½®å¯¹è±¡

> åœ¨å°ç¨‹åºé‡Œï¼Œç¨‹åºçš„åŠŸèƒ½åŠé…ç½®ä¸é¡µé¢å’Œç»„ä»¶å·®å¼‚è¾ƒå¤§ï¼Œå› æ­¤è¿è¡Œæ—¶æä¾›äº†ä¸¤ä¸ªæ–¹æ³• `createApp` å’Œ `createComponent`
> æ¥åˆ†åˆ«åˆ›å»ºç¨‹åºå’Œç»„ä»¶ï¼ˆé¡µé¢ï¼‰ã€‚`createApp` çš„å®ç°éå¸¸ç®€å•

**createComponent æ–¹æ³•ä¸»è¦åšäº†è¿™æ ·å‡ ä»¶äº‹æƒ…** ï¼š

  * å°†ç»„ä»¶çš„`state`è½¬æ¢æˆå°ç¨‹åºç»„ä»¶é…ç½®å¯¹è±¡çš„ `data`
  * å°†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯¹åº”åˆ°å°ç¨‹åºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
  * å°†ç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°å¯¹åº”åˆ°å°ç¨‹åºçš„äº‹ä»¶å¤„ç†å‡½æ•°

### 7.2 ç»„ä»¶ state è½¬æ¢

å…¶å®åœ¨ Taroï¼ˆReactï¼‰ ç»„ä»¶é‡Œï¼Œé™¤äº†ç»„ä»¶çš„ `state`ï¼Œ`JSX` é‡Œè¿˜å¯ä»¥è®¿é—®`props` ã€`render`
å‡½æ•°é‡Œå®šä¹‰çš„å€¼ã€ä»¥åŠä»»ä½•ä½œç”¨åŸŸä¸Šçš„æˆå‘˜ã€‚è€Œåœ¨å°ç¨‹åºä¸­ï¼Œä¸æ¨¡æ¿ç»‘å®šçš„æ•°æ®å‡æ¥è‡ªå¯¹åº”é¡µé¢ï¼ˆæˆ–ç»„ä»¶ï¼‰çš„ `data`ã€‚å› æ­¤ `JSX`
æ¨¡æ¿é‡Œè®¿é—®åˆ°çš„æ•°æ®éƒ½ä¼šå¯¹åº”åˆ°å°ç¨‹åºç»„ä»¶çš„ `data` ä¸Šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡åˆ—è¡¨æ¸²æŸ“çš„ä¾‹å­æ¥è¯´æ˜`state`å’Œ `data`æ˜¯å¦‚ä½•å¯¹åº”çš„...

**åœ¨ JSX é‡Œè®¿é—® state**

> åœ¨å°ç¨‹åºçš„ç»„ä»¶ä¸Šä½¿ç”¨ `wx:for` ç»‘å®šä¸€ä¸ªæ•°ç»„ï¼Œå°±å¯ä»¥å®ç°å¾ªç¯æ¸²æŸ“ã€‚ä¾‹å¦‚ï¼Œåœ¨ Taro é‡Œä½ å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š
```js
    { 
      state = {
        list: [1, 2, 3]
      }
      render () {
        return (
          <View>
            {this.state.list.map(item => <View>{item}</View>)}
          </View>
        )
      }
    }
```

ç¼–è¯‘åçš„å°ç¨‹åºç»„ä»¶æ¨¡æ¿ï¼š
```javascript
    <view>
      <view wx:for="{{list}}" wx:for-item="item">{{item}}</view> 
    </view>
```

å…¶ä¸­ `state.list` åªéœ€ç›´æ¥å¯¹åº”åˆ°å°ç¨‹åºï¼ˆé¡µé¢ï¼‰ç»„ä»¶çš„ `data.list` ä¸Šå³å¯...

**åœ¨ render é‡Œç”Ÿæˆäº†æ–°çš„å˜é‡**

ç„¶è€Œäº‹æƒ…é€šå¸¸æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œåœ¨ Taro é‡Œä¹Ÿå¯ä»¥è¿™ä¹ˆç”¨
```javascript
    {
      state = {
        list = [1, 2, 3]
      }
      render () {
        return (
          <View>
            {this.state.list.map(item => ++item).map(item => <View>{item}</View>)}
          </View>
        )
      }
    }
```

ç¼–è¯‘åçš„å°ç¨‹åºç»„ä»¶æ¨¡æ¿æ˜¯è¿™æ ·çš„ï¼š
```javascript
    <view>
      <view wx:for="{{$anonymousCallee__1}}" wx:for-item="item">{{item}}</view> 
    </view>...
```

> åœ¨ç¼–è¯‘æ—¶ä¼šç»™ Taro ç»„ä»¶åˆ›å»ºä¸€ä¸ª `_createData`çš„æ–¹æ³•ï¼Œé‡Œé¢ä¼šç”Ÿæˆ `$anonymousCallee__1` è¿™ä¸ªå˜é‡ï¼Œ
> $`anonymousCallee__1` æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ï¼Œå¯¹ `this.state.list` è¿›è¡Œç›¸å…³æ“ä½œåçš„å˜é‡ã€‚
> `$anonymousCallee__1` æœ€ç»ˆä¼šè¢«æ”¾åˆ°ç»„ä»¶çš„ data ä¸­ç»™æ¨¡æ¿è°ƒç”¨ï¼š
```js
    var $anonymousCallee__1 = this.state.list.map(function (item) {
      return ++item;
    });
```

> `render` é‡Œ `return`ä¹‹å‰çš„æ‰€æœ‰å®šä¹‰å˜é‡æˆ–è€…å¯¹ `props`ã€`state` è®¡ç®—äº§ç”Ÿæ–°å˜é‡çš„æ“ä½œï¼Œéƒ½ä¼šè¢«ç¼–è¯‘åˆ°
> `_createData` æ–¹æ³•é‡Œæ‰§è¡Œï¼Œè¿™ä¸€ç‚¹åœ¨å‰é¢ JSX ç¼–è¯‘æˆå°ç¨‹åºæ¨¡æ¿çš„ç›¸å…³æ–‡ç« ä¸­å·²ç»æåˆ°ã€‚æ¯å½“ Taro è°ƒç”¨ `this.setState`
> API æ¥æ›´æ–°æ•°æ®æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨ç”Ÿæˆçš„ `_createData`æ¥è·å–æœ€æ–°æ•°æ®...

### 7.3 å°†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯¹åº”åˆ°å°ç¨‹åºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

> åˆå§‹åŒ–è¿‡ç¨‹é‡Œçš„ç”Ÿå‘½å‘¨æœŸå¯¹åº”å¾ˆç®€å•ï¼Œåœ¨å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°é‡Œè°ƒç”¨ Taro ç»„ä»¶é‡Œå¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å³å¯ï¼Œä¾‹å¦‚ï¼šå°ç¨‹åºç»„ä»¶ `ready`
> çš„å›è°ƒå‡½æ•°é‡Œä¼šè°ƒç”¨ Taro ç»„ä»¶çš„ `componentDidMount` æ–¹æ³•ã€‚å®ƒä»¬çš„æ‰§è¡Œè¿‡ç¨‹å’Œå¯¹åº”å…³ç³»å¦‚ä¸‹å›¾...

![](/images/s_poetries_work_gitee_2020_09_252.png)

> å°ç¨‹åºé¡µé¢çš„`componentWillMount` æœ‰ä¸€ç‚¹ç‰¹æ®Šï¼Œä¼šæœ‰ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ã€‚ç”±äºå°ç¨‹åºçš„é¡µé¢éœ€è¦ç­‰åˆ° `onLoad`
> ä¹‹åæ‰å¯ä»¥è·å–åˆ°é¡µé¢çš„è·¯ç”±å‚æ•°ï¼Œå› æ­¤å¦‚æœæ˜¯å¯åŠ¨é¡µé¢ï¼Œä¼šç­‰åˆ° `onLoad` æ—¶æ‰ä¼šè§¦å‘ã€‚è€Œå¯¹äºå°ç¨‹åºå†…éƒ¨é€šè¿‡ `navigateTo`ç­‰ API
> è·³è½¬çš„é¡µé¢ï¼ŒTaro åšäº†ä¸€ä¸ªå…¼å®¹ï¼Œè°ƒç”¨ `navigateTo` æ—¶å°†é¡µé¢å‚æ•°å­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€å¯¹è±¡ä¸­ï¼Œåœ¨é¡µé¢ `attached`
> çš„æ—¶å€™ä»å…¨å±€å¯¹è±¡é‡Œå–åˆ°ï¼Œè¿™æ ·å°±ä¸ç”¨ç­‰åˆ°é¡µé¢ `onLoad` å³å¯è·å–åˆ°è·¯ç”±å‚æ•°ï¼Œè§¦å‘ `componentWillMount`ç”Ÿå‘½å‘¨æœŸ...

**çŠ¶æ€æ›´æ–°**

![](/images/s_poetries_work_gitee_2020_09_253.png)

  * Taro ç»„ä»¶çš„ `setState` è¡Œä¸ºæœ€ç»ˆä¼šå¯¹åº”åˆ°å°ç¨‹åºçš„`setData`ã€‚Taro å¼•å…¥äº†å¦‚ `nextTick` ï¼Œç¼–è¯‘æ—¶è¯†åˆ«æ¨¡æ¿ä¸­ç”¨åˆ°çš„æ•°æ®ï¼Œåœ¨ setData å‰è¿›è¡Œæ•°æ®å·®å¼‚æ¯”è¾ƒç­‰æ–¹å¼æ¥æé«˜ `setState`çš„æ€§èƒ½ã€‚
  * å¦‚ä¸Šå›¾ï¼Œç»„ä»¶è°ƒç”¨ `setState` æ–¹æ³•ä¹‹åï¼Œå¹¶ä¸ä¼šç«‹åˆ»æ‰§è¡Œç»„ä»¶æ›´æ–°é€»è¾‘ï¼Œè€Œæ˜¯ä¼šå°†æœ€æ–°çš„ `state` æš‚å­˜å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç­‰ `nextTick` å›è°ƒæ—¶æ‰ä¼šè®¡ç®—æœ€æ–°çš„ `state` è¿›è¡Œç»„ä»¶æ›´æ–°ã€‚è¿™æ ·å³ä½¿è¿ç»­å¤šæ¬¡çš„è°ƒç”¨`setState` å¹¶ä¸ä¼šè§¦å‘å¤šæ¬¡çš„è§†å›¾æ›´æ–°ã€‚åœ¨å°ç¨‹åºä¸­ `nextTick` æ˜¯è¿™ä¹ˆå®ç°çš„...
```js
    const nextTick = (fn, ...args) => {
      fn = typeof fn === 'function' ? fn.bind(null, ...args) : fn
      const timerFunc = wx.nextTick ? wx.nextTick : setTimeout
      timerFunc(fn)
    }...
```

> é™¤äº†è®¡ç®—å‡ºæœ€æ–°çš„ç»„ä»¶ `state` ï¼Œåœ¨ç»„ä»¶çŠ¶æ€æ›´æ–°è¿‡ç¨‹é‡Œè¿˜ä¼šè°ƒç”¨å‰é¢æåˆ°è¿‡çš„ `_createData` æ–¹æ³•ï¼Œå¾—åˆ°æœ€ç»ˆå°ç¨‹åºç»„ä»¶çš„
> `data`ï¼Œå¹¶è°ƒç”¨å°ç¨‹åºçš„ `setData` æ–¹æ³•æ¥è¿›è¡Œç»„ä»¶çš„æ›´æ–°

### 7.4 äº‹ä»¶å¤„ç†å‡½æ•°å¯¹åº”

åœ¨å°ç¨‹åºçš„ç»„ä»¶é‡Œï¼Œäº‹ä»¶å“åº”å‡½æ•°éœ€è¦é…ç½®åœ¨ methods å­—æ®µé‡Œã€‚è€Œåœ¨ JSX é‡Œï¼Œäº‹ä»¶æ˜¯è¿™æ ·ç»‘å®šçš„ï¼š
```javascript
    <View onClick={this.handleClick}></View>
```

ç¼–è¯‘çš„è¿‡ç¨‹ä¼šå°† JSX è½¬æ¢æˆå°ç¨‹åºæ¨¡æ¿ï¼š
```javascript
    <view bindclick="handleClick"></view>...
```

åœ¨`createComponent` æ–¹æ³•é‡Œï¼Œä¼šå°†äº‹ä»¶å“åº”å‡½æ•° `handleClick` æ·»åŠ åˆ° `methods` å­—æ®µä¸­ï¼Œå¹¶ä¸”åœ¨å“åº”å‡½æ•°é‡Œè°ƒç”¨çœŸæ­£çš„
`this.handleClick`æ–¹æ³•ã€‚

åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¼šæå–æ¨¡æ¿ä¸­ç»‘å®šè¿‡çš„æ–¹æ³•ï¼Œå¹¶å­˜åˆ°ç»„ä»¶çš„ `$events` å­—æ®µé‡Œï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å°±å¯ä»¥åªå°†ç”¨åˆ°çš„äº‹ä»¶å“åº”å‡½æ•°é…ç½®åˆ°å°ç¨‹åºç»„ä»¶çš„
`methods` å­—æ®µä¸­ã€‚

åœ¨è¿è¡Œæ—¶é€šè¿‡ `processEvent` è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†äº‹ä»¶çš„å¯¹åº”ï¼Œçœç•¥æ‰å¤„ç†è¿‡ç¨‹ï¼Œå°±æ˜¯è¿™æ ·çš„...
```js
    function processEvent (eventHandlerName, obj) {
      obj[eventHandlerName] = function (event) {
        // ...
    	scope[eventHandlerName].apply(callScope, realArgs)
      }
    }
```

> è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯è§£æå‡ºäº‹ä»¶å“åº”å‡½æ•°æ‰§è¡Œæ—¶çœŸæ­£çš„ä½œç”¨åŸŸ `callScope` ä»¥åŠä¼ å…¥çš„å‚æ•°ã€‚åœ¨ `JSX`é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·é€šè¿‡
> `bind`ä¼ å…¥å‚æ•°ï¼š
```javascript
    <View onClick={this.handleClick.bind(this, arga, argb)}></View>
```

> å°ç¨‹åºä¸æ”¯æŒé€šè¿‡ `bind` çš„æ–¹å¼ä¼ å…¥å‚æ•°ï¼Œä½†æ˜¯å°ç¨‹åºå¯ä»¥ç”¨ `data` å¼€å¤´çš„æ–¹å¼ï¼Œå°†æ•°æ®ä¼ é€’åˆ°
> `event.currentTarget.dataset` ä¸­ã€‚ç¼–è¯‘è¿‡ç¨‹ä¼šå°† `bind` æ–¹å¼ä¼ é€’çš„å‚æ•°å¯¹åº”åˆ°`dataset`
> ä¸­ï¼Œ`processEvent` å‡½æ•°ä¼šä» `dataset` é‡Œå–åˆ°ä¼ å…¥çš„å‚æ•°ä¼ ç»™çœŸæ­£çš„äº‹ä»¶å“åº”å‡½æ•°ã€‚

è‡³æ­¤ï¼Œç»è¿‡ç¼–è¯‘ä¹‹åçš„ Taro ç»„ä»¶ç»ˆäºå¯ä»¥è¿è¡Œåœ¨å°ç¨‹åºç¯å¢ƒé‡Œäº†...

### 7.5 å¯¹ API è¿›è¡Œ Promise åŒ–çš„å¤„ç†

> Taro å¯¹å°ç¨‹åºçš„æ‰€æœ‰ API è¿›è¡Œäº†ä¸€ä¸ªåˆ†ç±»æ•´ç†ï¼Œå°†å…¶ä¸­çš„å¼‚æ­¥ API åšäº†ä¸€å±‚
> `Promise`åŒ–çš„å°è£…ã€‚ä¾‹å¦‚ï¼Œ`wx.getStorage`ç»è¿‡ä¸‹é¢çš„å¤„ç†å¯¹åº”åˆ°`Taro.getStorage`(æ­¤å¤„ä»£ç ä½œç¤ºä¾‹ç”¨ï¼Œä¸å®é™…æºä»£ç ä¸å°½ç›¸åŒ)
```js
    Taro['getStorage'] = options => {
      let obj = Object.assign({}, options)
      const p = new Promise((resolve, reject) => {
    	['fail', 'success', 'complete'].forEach((k) => {
    	  obj[k] = (res) => {
    	    options[k] && options[k](res)
    	    if (k === 'success') {
    		  resolve(res)
    	    } else if (k === 'fail') {
    		  reject(res)
    	    }
    	  }
    	})
    	wx['getStorage'](obj)
      })
      return p
    }...
```

å°±å¯ä»¥è¿™ä¹ˆè°ƒç”¨äº†ï¼š
```js
    // å°ç¨‹åºçš„è°ƒç”¨æ–¹å¼
    Taro.getStorage({
      key: 'test',
      success() {
    	
      }
    })
    // åœ¨ Taro é‡Œä¹Ÿå¯ä»¥è¿™æ ·è°ƒç”¨
    Taro.getStorage({
      key: 'test'
    }).then(() => {
      // success
    })...
```

## å…«ã€H5 è¿è¡Œæ—¶

### 8.1 H5 è¿è¡Œæ—¶è§£æ

> é¦–å…ˆï¼Œæˆ‘ä»¬é€‰ç”¨`Nerv`ä½œä¸º `Web`
> ç«¯çš„è¿è¡Œæ—¶æ¡†æ¶ã€‚ä½ å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼šåŒæ ·æ˜¯ç±»`React`æ¡†æ¶ï¼Œä¸ºä½•æˆ‘ä»¬ä¸ç›´æ¥ç”¨`React`ï¼Œè€Œæ˜¯ç”¨`Nerv`å‘¢ï¼Ÿ

ä¸ºäº†æ›´å¿«æ›´ç¨³ã€‚å¼€å‘è¿‡ç¨‹ä¸­å‰ç«¯æ¡†æ¶æœ¬èº«æœ‰å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œå¾ˆæœ‰å¯èƒ½æ— æ³•å¾—åˆ°åŠæ—¶çš„ä¿®å¤ï¼Œå¯¼è‡´æ•´ä¸ªé¡¹ç›®çš„è¿›åº¦å—å½±å“ã€‚Nervå°±ä¸ä¸€æ ·ã€‚ä½œä¸ºå›¢é˜Ÿè‡ªç ”çš„äº§å“ï¼Œå‡ºç°ä»»ä½•é—®é¢˜æˆ‘ä»¬éƒ½å¯ä»¥åœ¨å›¢é˜Ÿå†…éƒ¨å¿«é€Ÿå¾—åˆ°è§£å†³ã€‚ä¸æ­¤åŒæ—¶ï¼ŒNervä¹Ÿå…·æœ‰ä¸Reactç›¸åŒçš„
APIï¼ŒåŒæ ·ä½¿ç”¨ Virtual DOM æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ï¼Œæ­£å¸¸ä½¿ç”¨ä¸Reactå¹¶æ²¡æœ‰åŒºåˆ«ï¼Œå®Œå…¨å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚

ä½¿ç”¨Taroä¹‹åï¼Œæˆ‘ä»¬ä¹¦å†™çš„æ˜¯ç±»ä¼¼äºä¸‹å›¾çš„ä»£ç ...

![](/images/s_poetries_work_gitee_2020_09_254.png)

> æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå°±ç®—æ˜¯è½¬æ¢è¿‡çš„ä»£ç ï¼Œä¹Ÿä¾ç„¶å­˜åœ¨ç€`view`ã€`button`ç­‰åœ¨ `Web` å¼€å‘ä¸­å¹¶ä¸å­˜åœ¨çš„ç»„ä»¶ã€‚å¦‚ä½•åœ¨ `Web`
> ç«¯æ­£å¸¸ä½¿ç”¨è¿™äº›ç»„ä»¶ï¼Ÿè¿™æ˜¯æˆ‘ä»¬ç¢°åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜

#### 8.1.1 ç»„ä»¶å®ç°

![](/images/s_poetries_work_gitee_2020_09_255.png)

ä½œä¸ºå¼€å‘è€…ï¼Œä½ ç¬¬ä¸€ååº”æˆ–è®¸ä¼šå°è¯•åœ¨ç¼–è¯‘é˜¶æ®µä¸‹åŠŸå¤«ï¼Œå°è¯•ç›´æ¥ä½¿ç”¨æ•ˆæœç±»ä¼¼çš„ Web
ç»„ä»¶æ›¿ä»£ï¼šç”¨`div`æ›¿ä»£`view`ï¼Œç”¨`img`æ›¿ä»£`image`ï¼Œä»¥æ­¤ç±»æ¨ã€‚

è´¹åŠ²å¿ƒæœºæå®šæ ‡ç­¾è½¬æ¢ä¹‹åï¼Œä¸Šé¢è¿™ä¸ªå·®å¼‚ä¼¼ä¹æ˜¯è§£å†³äº†ã€‚ä½†å¾ˆå¿«ä½ å°±ä¼šç¢°åˆ°ä¸€äº›æ›´åŠ æ£˜æ‰‹çš„é—®é¢˜ï¼š`hover-start-time`ã€`hover-stay-
time`ç­‰ç­‰è¿™äº›å¸¸è§„ Web å¼€å‘ä¸­å¹¶ä¸å­˜åœ¨çš„å±æ€§è¦å¦‚ä½•å¤„ç†ï¼Ÿ

å›é¡¾ä¸€ä¸‹ï¼šåœ¨å‰é¢è®²åˆ°å¤šç«¯è½¬æ¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´åˆ°äº†`babel`ã€‚åœ¨Taroä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`babylon`ç”Ÿæˆ `AST`ï¼Œ`babel-
traverse`å»ä¿®æ”¹å’Œç§»åŠ¨ `AST` ä¸­çš„èŠ‚ç‚¹ã€‚ä½†babelæ‰€åšçš„å·¥ä½œè¿œè¿œä¸æ­¢è¿™äº›ã€‚

æˆ‘ä»¬ä¸å¦¨å»`babel`çš„ `playground` çœ‹ä¸€çœ‹ä»£ç åœ¨è½¬è¯‘å‰åçš„å¯¹æ¯”ï¼šåœ¨ä½¿ç”¨äº†`@babel/preset-env`çš„`BUILT-
INS`ä¹‹åï¼Œç®€å•çš„ä¸€å¥æºç `new Map()`ï¼Œåœ¨`babel`ç¼–è¯‘åå´å˜æˆäº†å¥½å‡ è¡Œä»£ç ...

![](/images/s_poetries_work_gitee_2020_09_256.png)

æ³¨æ„çœ‹è¿™å‡ ä¸ªæ–‡ä»¶ï¼š`core-js/modules/web.dom.iterable`ï¼Œ`core-
js/modules/es6.array.iterator`ï¼Œ`core-js/modules/es6.map`ã€‚æˆ‘ä»¬å¯ä»¥åœ¨`core-js`çš„ `Git`
ä»“åº“æ‰¾åˆ°ä»–ä»¬çš„çœŸèº«ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™å‡ ä¸ªæ¨¡å—å°±æ˜¯å¯¹åº”çš„ es ç‰¹æ€§è¿è¡Œæ—¶çš„å®ç°ã€‚

ä»æŸç§è§’åº¦ä¸Šè®²ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…å’Œbabeléå¸¸åƒã€‚babelæŠŠåŸºäºæ–°ç‰ˆ ECMAScript è§„èŒƒçš„ä»£ç è½¬æ¢ä¸ºåŸºäºæ—§ `ECMAScript`
è§„èŒƒçš„ä»£ç ï¼Œè€ŒTaroå¸Œæœ›æŠŠåŸºäºReactè¯­æ³•çš„ä»£ç è½¬æ¢ä¸ºå°ç¨‹åºçš„è¯­æ³•ã€‚æˆ‘ä»¬ä»babelå—åˆ°äº†å¯å‘ï¼šæ—¢ç„¶`babel`å¯ä»¥é€šè¿‡è¿è¡Œæ—¶æ¡†æ¶æ¥å®ç°æ–°ç‰¹æ€§ï¼Œé‚£æˆ‘ä»¬ä¹ŸåŒæ ·å¯ä»¥é€šè¿‡è¿è¡Œæ—¶ä»£ç ï¼Œå®ç°ä¸Šé¢è¿™äº›
Web å¼€å‘ä¸­ä¸å­˜åœ¨çš„åŠŸèƒ½ã€‚

ä¸¾ä¸ªä¾‹å­ã€‚å¯¹äº`view`ç»„ä»¶ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸ªæ™®é€šçš„ç±» `React` ç»„ä»¶ï¼Œå®ƒæŠŠå®ƒçš„å­ç»„ä»¶å¦‚å®å±•ç¤ºå‡ºæ¥...
```js
    import Nerv, { Component } from 'nervjs';
    
    class View extends Component {
      render() {
        return (
          <div>{this.props.children}</div>
        );
      }
    }...
```

> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹`hover-start-
> time`åšå¤„ç†ã€‚ä¸Taroå…¶ä»–åœ°æ–¹çš„å‘½åè§„èŒƒä¸€è‡´ï¼Œæˆ‘ä»¬è¿™ä¸ª`View`ç»„ä»¶æ¥å—çš„å±æ€§åå°†ä¼šæ˜¯é©¼å³°å‘½åæ³•ï¼š`hoverStartTime`ã€‚`hoverStartTime`å‚æ•°å†³å®šæˆ‘ä»¬å°†åœ¨`View`ç»„ä»¶è§¦å‘`touch`äº‹ä»¶å¤šä¹…åæ”¹å˜ç»„ä»¶çš„æ ·å¼...
```js
    // ç¤ºä¾‹ä»£ç 
    render() {
      const {
        hoverStartTime = 50,
        onTouchStart
      } = this.props;
    
      const _onTouchStart = e => {
        setTimeout(() => {
          // @TODO è§¦å‘touchæ ·å¼æ”¹å˜
        }, hoverStartTime);
        onTouchStart && onTouchStart(e);
      }
      return (
        <div onTouchStart={_onTouchStart}>
          {this.props.children}
        </div>
      );
    }...
```

> å†ç¨åŠ ä¿®é¥°ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„`Web`ç‰ˆ `View`ç»„ä»¶

`view`å¯ä»¥è¯´æ˜¯å°ç¨‹åºæœ€ç®€å•çš„ç»„ä»¶ä¹‹ä¸€äº†ã€‚`text`çš„å®ç°ç”šè‡³æ¯”ä¸Šé¢çš„ä»£ç è¿˜è¦ç®€å•å¾—å¤šã€‚ä½†è¿™å¹¶ä¸è¯´æ˜ç»„ä»¶çš„å®ç°ä¹‹è·¯ä¸Šå°±æ²¡æœ‰éšœç¢ã€‚å¤æ‚å¦‚`swiper`ï¼Œ`scroll-
view`ï¼Œ`tabbar`ï¼Œæˆ‘ä»¬éœ€è¦èŠ±è´¹å¤§é‡çš„ç²¾åŠ›åˆ†æå°ç¨‹åºåŸç”Ÿç»„ä»¶çš„ `API`ï¼Œäº¤äº’è¡Œä¸ºï¼Œæç«¯å€¼å¤„ç†ï¼Œæ¥å—çš„å±æ€§ç­‰ç­‰ï¼Œå†é€šè¿‡ Web æŠ€æœ¯å®ç°ã€‚...

### 8.2 API é€‚é…

> é™¤äº†ç»„ä»¶ï¼Œå°ç¨‹åºä¸‹æœ‰ä¸€äº› API ä¹Ÿæ˜¯ Web å¼€å‘ä¸­æ‰€ä¸å…·å¤‡çš„ã€‚æ¯”å¦‚å°ç¨‹åºæ¡†æ¶å†…ç½®çš„`wx.request/wx.getStorage`ç­‰
> APIï¼›ä½†åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`fetch/localStorage`ç­‰å†…ç½®çš„å‡½æ•°æˆ–è€…å¯¹è±¡

![](/images/s_poetries_work_gitee_2020_09_257.png)

å°ç¨‹åºçš„ API å®ç°æ˜¯ä¸ªå·¨å¤§çš„é»‘ç›’ï¼Œæˆ‘ä»¬ä»…ä»…çŸ¥é“å¦‚ä½•ä½¿ç”¨å®ƒï¼Œä½¿ç”¨å®ƒä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Œä½†å¯¹å®ƒå†…éƒ¨çš„å®ç°ä¸€æ— æ‰€çŸ¥ã€‚

å¦‚ä½•è®© Web ç«¯ä¹Ÿèƒ½ä½¿ç”¨å°ç¨‹åºæ¡†æ¶ä¸­æä¾›çš„è¿™äº›åŠŸèƒ½ï¼Ÿæ—¢ç„¶å·²ç»çŸ¥é“è¿™ä¸ªé»‘ç›’çš„å…¥å‚å‡ºå‚æƒ…å†µï¼Œé‚£æˆ‘ä»¬è‡ªå·±æ‰“é€ ä¸€ä¸ªé»‘ç›’å°±å¥½äº†ã€‚

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¾ç„¶é€šè¿‡è¿è¡Œæ—¶æ¡†æ¶æ¥å®ç°è¿™äº› Web ç«¯ä¸å­˜åœ¨çš„èƒ½åŠ›ã€‚

å…·ä½“è¯´æ¥ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åˆ†æå°ç¨‹åºåŸç”Ÿ APIï¼Œæœ€åé€šè¿‡ Web æŠ€æœ¯å®ç°ã€‚æœ‰å…´è¶£å¯ä»¥åœ¨ Git ä»“åº“ä¸­çœ‹åˆ°è¿™äº›åŸç”Ÿ API
çš„å®ç°ã€‚ä¸‹é¢ä»¥`wx.setStorage`ä¸ºä¾‹è¿›è¡Œç®€å•è§£æã€‚

`wx.setStorage`æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¥å£ï¼Œå¯ä»¥æŠŠ`key: value`æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ã€‚å¾ˆå®¹æ˜“è”æƒ³åˆ°ï¼Œåœ¨ Web
å¼€å‘ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ•°æ®å­˜å‚¨æ¦‚å¿µï¼Œè¿™å°±æ˜¯`localStorage`ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç›®æ ‡å·²ç»ååˆ†æ˜ç¡®ï¼šæˆ‘ä»¬éœ€è¦å€ŸåŠ©`äºlocalStorage`ï¼Œå®ç°ä¸€ä¸ªä¸`wx.setStorage`ç›¸åŒçš„
APIã€‚...

> è€Œåœ¨ Web ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¾€æœ¬åœ°å­˜å‚¨å†™å…¥æ•°æ®ï¼Œä½¿ç”¨çš„ API æ˜¯`localStorage.setItem(key,
> value)`ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯ä»¥æ„æ€å‡ºè¿™ä¸ªå‡½æ•°çš„é›å½¢
```js
    /* ç¤ºä¾‹ä»£ç  */
    function setStorage({ key, value }) {
      localStorage.setItem(key, value);
    }
```

æˆ‘ä»¬é¡ºæ‰‹åšç‚¹ä¼˜åŒ–ï¼ŒæŠŠåŸºäºå¼‚æ­¥å›è°ƒçš„ API éƒ½ç»™åšäº†ä¸€å±‚ Promise åŒ…è£…ï¼Œè¿™å¯ä»¥è®©ä»£ç çš„æµç¨‹å¤„ç†æ›´åŠ æ–¹ä¾¿ã€‚æ‰€ä»¥è¿™æ®µä»£ç çœ‹èµ·æ¥ä¼šåƒä¸‹é¢è¿™æ ·ï¼š
```js
    /* ç¤ºä¾‹ä»£ç  */
    function setStorage({ key, value }) {
      localStorage.setItem(key, value);
      return Promise.resolve({ errMsg: 'setStorage:ok' });
    }...
```

çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œä½†å¼€å‘çš„é“è·¯ä¸ä¼šå¦‚æ­¤å¹³å¦ã€‚æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†å…¶ä½™çš„å…¥å‚ï¼šsuccessã€failå’Œcompleteã€‚successå›è°ƒä¼šåœ¨æ“ä½œæˆåŠŸå®Œæˆæ—¶è°ƒç”¨ï¼Œfailä¼šåœ¨æ“ä½œå¤±è´¥çš„æ—¶å€™æ‰§è¡Œï¼Œcompleteåˆ™æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œã€‚setStorageå‡½æ•°åªä¼šåœ¨keyå€¼æ˜¯Stringç±»å‹æ—¶æœ‰æ­£ç¡®çš„è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºè¿™ä¸ªå‡½æ•°æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„ç±»å‹åˆ¤æ–­ï¼Œå¹¶åœ¨å¼‚å¸¸æƒ…å†µä¸‹æ‰§è¡Œfailå›è°ƒã€‚ç»è¿‡è¿™è½®å˜åŠ¨ï¼Œè¿™æ®µä»£ç çœ‹èµ·æ¥ä¼šåƒä¸‹é¢è¿™æ ·...
```js
    /* ç¤ºä¾‹ä»£ç  */
    function setStorage({ key, value, success, fail, complete }) {
      let res = { errMsg: 'setStorage:ok' }
      if (typeof key === 'string') {
        localStorage.setItem(key, value);
        success && success(res);
      } else {
        fail && fail(res);
        return Promise.reject(res);
      }
      complete && complete(res);
      return Promise.resolve({ errMsg: 'setStorage:ok' });
    }...
```

æŠŠè¿™ä¸ª API å®ç°æŒ‚è½½åˆ°Taroæ¨¡å—ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡`Taro.setStorage`æ¥è°ƒç”¨è¿™ä¸ª API äº†ã€‚

å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº› API æ˜¯ Web ç«¯æ— è®ºå¦‚ä½•æ— æ³•å®ç°çš„ï¼Œæ¯”å¦‚`wx.login`ï¼Œåˆæˆ–è€…`wx.scanCode`ã€‚æˆ‘ä»¬ç»´æŠ¤äº†ä¸€ä¸ª API
å®ç°æƒ…å†µçš„åˆ—è¡¨ï¼Œåœ¨å®é™…çš„å¤šç«¯é¡¹ç›®å¼€å‘ä¸­åº”è¯¥å°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒä»¬...

### 8.3 è·¯ç”±

>
> ä½œä¸ºå°ç¨‹åºçš„ä¸€å¤§èƒ½åŠ›ï¼Œå°ç¨‹åºæ¡†æ¶ä¸­ä»¥æ ˆçš„å½¢å¼ç»´æŠ¤äº†å½“å‰æ‰€æœ‰çš„é¡µé¢ï¼Œç”±æ¡†æ¶ç»Ÿä¸€ç®¡ç†ã€‚ç”¨æˆ·åªéœ€è¦è°ƒç”¨`wx.navigateTo`,`wx.navigateBack`,`wx.redirectTo`ç­‰å®˜æ–¹
> APIï¼Œå°±å¯ä»¥å®ç°é¡µé¢çš„è·³è½¬ã€å›é€€ã€é‡å®šå‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒé¡µé¢æ ˆçš„ç»†èŠ‚ã€‚ä½†æ˜¯ä½œä¸ºå¤šç«¯é¡¹ç›®ï¼Œå½“æˆ‘ä»¬...

å°ç¨‹åºçš„è·¯ç”±æ¯”è¾ƒè½»é‡ã€‚ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡`app.json`ä¸ºå°ç¨‹åºé…ç½®é¡µé¢åˆ—è¡¨ï¼š
```js
    {
      "pages": [
        "pages/index/index",
        "pages/logs/logs"
      ],
      // ...
    }
```

> åœ¨è¿è¡Œæ—¶ï¼Œå°ç¨‹åºå†…ç»´æŠ¤äº†ä¸€ä¸ªé¡µé¢æ ˆï¼Œå§‹ç»ˆå±•ç¤ºæ ˆé¡¶çš„é¡µé¢ï¼ˆ`Page`å¯¹è±¡ï¼‰ã€‚å½“ç”¨æˆ·è¿›è¡Œè·³è½¬ã€åé€€ç­‰æ“ä½œæ—¶ï¼Œç›¸åº”çš„ä¼šä½¿é¡µé¢æ ˆè¿›è¡Œå…¥æ ˆã€å‡ºæ ˆç­‰æ“ä½œ

åŒæ—¶ï¼Œåœ¨é¡µé¢æ ˆå‘ç”Ÿè·¯ç”±å˜åŒ–æ—¶ï¼Œè¿˜ä¼šè§¦å‘ç›¸åº”é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ

**å¯¹äº Web ç«¯å•é¡µåº”ç”¨è·¯ç”±ï¼Œæˆ‘ä»¬åˆ™ä»¥react-routerä¸ºä¾‹è¿›è¡Œè¯´æ˜**

  * é¦–å…ˆï¼Œ`react-router`å¼€å§‹é€šè¿‡`history`å·¥å…·ç›‘å¬é¡µé¢è·¯å¾„çš„å˜åŒ–ã€‚
  * åœ¨é¡µé¢è·¯å¾„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`react-router`ä¼šæ ¹æ®æ–°çš„`location`å¯¹è±¡ï¼Œè§¦å‘ UI å±‚çš„æ›´æ–°ã€‚
  * è‡³äº UI å±‚å¦‚ä½•æ›´æ–°ï¼Œåˆ™æ˜¯å–å†³äºæˆ‘ä»¬åœ¨Routeç»„ä»¶ä¸­å¯¹é¡µé¢è·¯å¾„å’Œç»„ä»¶çš„ç»‘å®šï¼Œç”šè‡³å¯ä»¥å®ç°åµŒå¥—è·¯ç”±ã€‚
  * å¯ä»¥è¯´ï¼Œ`react-router`çš„è·¯ç”±æ–¹æ¡ˆæ˜¯ç»„ä»¶çº§åˆ«çš„ã€‚
  * å…·ä½“åˆ°`Taro`ï¼Œä¸ºäº†ä¿æŒè·Ÿå°ç¨‹åºçš„è¡Œä¸ºä¸€è‡´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç»†è‡´åˆ°ç»„ä»¶çº§åˆ«çš„è·¯ç”±æ–¹æ¡ˆï¼Œä½†éœ€è¦ä¸ºæ¯æ¬¡è·¯ç”±ä¿å­˜å®Œæ•´çš„é¡µé¢æ ˆã€‚
  * å®ç°å½¢å¼ä¸Šï¼Œæˆ‘ä»¬å‚è€ƒ`react-router`ï¼šç›‘å¬é¡µé¢è·¯å¾„å˜åŒ–ï¼Œå†è§¦å‘`UI` æ›´æ–°ã€‚è¿™æ˜¯`React`çš„ç²¾é«“ä¹‹ä¸€ï¼Œå•å‘æ•°æ®æµ...

![](/images/s_poetries_work_gitee_2020_09_258.png)

>
> `@tarojs/router`åŒ…ä¸­åŒ…å«äº†ä¸€ä¸ªè½»é‡çš„`history`å®ç°ã€‚`history`ä¸­ç»´æŠ¤äº†ä¸€ä¸ªæ ˆï¼Œç”¨æ¥è®°å½•é¡µé¢å†å²çš„å˜åŒ–ã€‚å¯¹å†å²è®°å½•çš„ç›‘å¬ï¼Œä¾èµ–ä¸¤ä¸ªäº‹ä»¶ï¼š`hashchange`å’Œ`popstate`ã€‚
```js
    /* ç¤ºä¾‹ä»£ç  */
    window.addEventListener('hashchange', () => {});
    window.addEventListener('popstate', () => {})
```

  * å¯¹äºä½¿ç”¨ `Hash`æ¨¡å¼çš„é¡µé¢è·¯ç”±ï¼Œæ¯æ¬¡é¡µé¢è·³è½¬éƒ½ä¼šä¾æ¬¡è§¦å‘`popstate`å’Œ`hashchange`äº‹ä»¶ã€‚ç”±äºåœ¨`popstate`çš„å›è°ƒä¸­å¯ä»¥å–åˆ°å½“å‰é¡µé¢çš„ `state`ï¼Œæˆ‘ä»¬é€‰æ‹©å®ƒä½œä¸ºä¸»è¦è·³è½¬é€»è¾‘çš„å®¹å™¨ã€‚
  * ä½œä¸º UI å±‚ï¼Œ`@tarojs/router`åŒ…æä¾›äº†ä¸€ä¸ª`Router`ç»„ä»¶ï¼Œç»´æŠ¤é¡µé¢æ ˆã€‚ä¸å°ç¨‹åºç±»ä¼¼ï¼Œç”¨æˆ·ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨`Router`ç»„ä»¶ï¼Œè€Œæ˜¯ç”±Taroè‡ªåŠ¨å¤„ç†ã€‚
  * å¯¹äºå†å²æ ˆæ¥è¯´ï¼Œæ— éå°±æ˜¯ä¸‰ç§æ“ä½œï¼š`push`, `pop`ï¼Œè¿˜æœ‰`replace`ã€‚åœ¨å†å²æ ˆå˜åŠ¨æ—¶è§¦å‘`Router`çš„å›è°ƒï¼Œå°±å¯ä»¥è®©`Router`ä¹ŸåŒæ­¥å˜åŒ–ã€‚è¿™å°±æ˜¯Taroä¸­è·¯ç”±çš„åŸºæœ¬åŸç†...

### 8.4 Redux å¤„ç†

  * æ¯å½“æåˆ°Reactçš„æ•°æ®æµï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸æåˆ°Reduxã€‚é€šè¿‡åˆå¹¶Reducerï¼ŒReduxå¯ä»¥è®©å¤§å‹åº”ç”¨ä¸­çš„æ•°æ®æµæ›´åŠ è§„åˆ™ã€å¯é¢„æµ‹ã€‚
  * æˆ‘ä»¬åœ¨Taroä¸­åŠ å…¥äº†Reduxçš„æ”¯æŒï¼Œé€šè¿‡å¯¼å…¥`@tarojs/redux`ï¼Œå³å¯åœ¨å°ç¨‹åºç«¯ä½¿ç”¨Reduxçš„åŠŸèƒ½ã€‚
  * å¯¹äº Web ç«¯ï¼Œæˆ‘ä»¬å°è¯•ç›´æ¥ä½¿ç”¨`nerv-redux`åŒ…æä¾›æ”¯æŒï¼Œä½†è¿™ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜...
```js
    import Nerv from 'nervjs'
    import { connect } from 'nerv-redux'
    
    @connect(() => {})
    class Index extends Nerv.Componnet {
      componentDidShow() { console.log('didShow') }
      componentDidMount() { console.log('didMount') }
      render() { return '' }
    }...
```

  * å›æƒ³ä¸€ä¸‹å‰é¢è®²çš„`componentDidShow`çš„å®ç°ï¼šæˆ‘ä»¬ç»§æ‰¿ï¼Œå¹¶ä¸”æ”¹å†™ `componentDidMount`ã€‚
  * ä½†æ˜¯å¯¹äºä½¿ç”¨Reduxçš„é¡µé¢æ¥è¯´ï¼Œæˆ‘ä»¬ç»§æ‰¿çš„ç±»ï¼Œæ˜¯ç»è¿‡`@connect`ä¿®é¥°è¿‡çš„ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ã€‚
  * é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼šè¿™ä¸ªé«˜é˜¶ç»„ä»¶çš„ç­¾åé‡Œå¹¶æ²¡æœ‰`componentDidShow`è¿™ä¸€ä¸ªå‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ `componentDidMount` å†…ï¼Œç†æ‰€å½“ç„¶æ˜¯å–ä¸åˆ°`componentDidShow`çš„ã€‚
  * ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹`react-redux`ä»£ç è¿›è¡Œäº†ä¸€äº›å°æ”¹è£…ï¼Œè¿™å°±æ˜¯`@taro/redux-h5`çš„ç”±æ¥...

## ä¹ã€æ›´å¤šå‚è€ƒ

  * [Taroå®˜æ–¹æ–‡æ¡£ (opens new window)](https://nervjs.github.io/taro/docs/GETTING-STARTED.html)

é˜…è¯»å…¨æ–‡

